sap.ui.define([                                                                                                                                                                                                                                                
    "sap/ui/core/mvc/Controller",                                                                                                                                                                                                                              
    "com/vistex/zagriplan/model/models",                                                                                                                                                                                                                       
    "sap/ui/model/json/JSONModel",                                                                                                                                                                                                                             
    "sap/ui/model/odata/v2/ODataModel",                                                                                                                                                                                                                        
    "com/vistex/zagriplan/model/base"                                                                                                                                                                                                                          
], function(Controller, models, JSONModel,ODataModel,base) {                                                                                                                                                                                                   
    "use strict";                                                                                                                                                                                                                                              
                                                                                                                                                                                                                                                               
    return Controller.extend("com.vistex.zagriplan.controller.App", {                                                                                                                                                                                          
        onInit: function() {                                                                                                                                                                                                                                   
            models.component = this.getOwnerComponent(); // set component reference                                                                                                                                                                            
            this.initModels();                                                                                                                                                                                                                                 
           this.getTokenGis();                                                                                                                                                                                                                                 
            var that = this;                                                                                                                                                                                                                                   
            this.oOwnerComponent = this.getOwnerComponent();                                                                                                                                                                                                   
            this.oRouter = this.oOwnerComponent.getRouter();                                                                                                                                                                                                   
            this.oModel = models.callBackEnd();                                                                                                                                                                                                                
                                                                                                                                                                                                                                                               
            this.oModel.read("/GetCentroSet", {                                                                                                                                                                                                                
                success: function(oData) {                                                                                                                                                                                                                     
                    var json = new JSONModel();                                                                                                                                                                                                                
                    json.setSizeLimit(oData.results.length);                                                                                                                                                                                                   
                    json.setData(oData);                                                                                                                                                                                                                       
                    sap.ui.getCore().setModel(json, "modelCentro");                                                                                                                                                                                            
                    var then = that;                                                                                                                                                                                                                           
                    that.oModel.read("/GetAreaCultivoSet", {                                                                                                                                                                                                   
                        success: function(oData1) {                                                                                                                                                                                                            
                            var json1 = new JSONModel();                                                                                                                                                                                                       
                            json1.setSizeLimit(oData1.results.length);                                                                                                                                                                                         
                            json1.setData(oData1);                                                                                                                                                                                                             
                            sap.ui.getCore().setModel(json1, "modelAreaCultivo");                                                                                                                                                                              
                            // GET SAFRA                                                                                                                                                                                                                       
                            then.oModel.read("/GetSafraSet", {                                                                                                                                                                                                 
                                success: function(oData2) {                                                                                                                                                                                                    
                                    var json2 = new JSONModel();                                                                                                                                                                                               
                                    json2.setSizeLimit(oData2.results.length);                                                                                                                                                                                 
                                    json2.setData(oData2);                                                                                                                                                                                                     
                                    sap.ui.getCore().setModel(json2, "modelSafra");                                                                                                                                                                            
                                }                                                                                                                                                                                                                              
                            });                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                               
                        }                                                                                                                                                                                                                                      
                    });                                                                                                                                                                                                                                        
                                                                                                                                                                                                                                                               
                }                                                                                                                                                                                                                                              
            });                                                                                                                                                                                                                                                
        },                                                                                                                                                                                                                                                     
        initModels: function() {                                                                                                                                                                                                                               
            var thiz = this;                                                                                                                                                                                                                                   
            models.models.forEach(function(item) {                                                                                                                                                                                                             
                var oModel = new JSONModel();                                                                                                                                                                                                                  
                oModel.setData(item.data);                                                                                                                                                                                                                     
                thiz.getOwnerComponent().setModel(oModel, item.model); // set to component                                                                                                                                                                     
                sap.ui.getCore().setModel(oModel, item.model);                                                                                                                                                                                                 
            });                                                                                                                                                                                                                                                
        },                                                                                                                                                                                                                                                     
        getTokenGis : function(){                                                                                                                                                                                                                              
        		var oModel = models.getTokenGis();                                                                                                                                                                                                                   
				oModel.read("/IrrGisTokenSet", {                                                                                                                                                                                                                           
				success: function (oData) {                                                                                                                                                                                                                                
					base.token = oData.results[0].Token;                                                                                                                                                                                                                      
				}                                                                                                                                                                                                                                                          
				                                                                                                                                                                                                                                                           
				});                                                                                                                                                                                                                                                        
        },                                                                                                                                                                                                                                                     
        /**                                                                                                                                                                                                                                                    
         * Convenience method for getting the resource bundle.                                                                                                                                                                                                 
         * @public                                                                                                                                                                                                                                             
         * @returns {sap.ui.model.resource.ResourceModel} the resourceModel of the component                                                                                                                                                                   
         */                                                                                                                                                                                                                                                    
        getResourceBundle: function() {                                                                                                                                                                                                                        
            return this.getOwnerComponent().getModel("i18n").getResourceBundle();                                                                                                                                                                              
        },                                                                                                                                                                                                                                                     
        /**                                                                                                                                                                                                                                                    
         * Convenience method for getting text from i18n                                                                                                                                                                                                       
         * @param {string} key - accept key as string                                                                                                                                                                                                          
         * @param {string} args - accept args                                                                                                                                                                                                                  
         * @returns {string} - return string value of key from i18n                                                                                                                                                                                            
         * */                                                                                                                                                                                                                                                  
        getText: function(key, args) {                                                                                                                                                                                                                         
            return this.getResourceBundle().getText(key, args);                                                                                                                                                                                                
        },                                                                                                                                                                                                                                                     
                                                                                                                                                                                                                                                               
    });                                                                                                                                                                                                                                                        
});                                                                                                                                                                                                                                                            