sap.ui.define([                                                                                                                                                                                                                                                
	"sap/ui/core/mvc/Controller",                                                                                                                                                                                                                                 
	"com/vistex/zagriplan/model/models",                                                                                                                                                                                                                          
	"sap/ui/model/json/JSONModel",                                                                                                                                                                                                                                
	"sap/ui/Device",                                                                                                                                                                                                                                              
	"sap/ui/core/routing/History",                                                                                                                                                                                                                                
	"sap/m/MessageBox",                                                                                                                                                                                                                                           
	"com/vistex/zagriplan/util/gis",                                                                                                                                                                                                                              
	"sap/m/Link",                                                                                                                                                                                                                                                 
	"sap/m/MessageItem",                                                                                                                                                                                                                                          
	"sap/m/MessageView",                                                                                                                                                                                                                                          
	"sap/m/Button",                                                                                                                                                                                                                                               
	"sap/m/Dialog",                                                                                                                                                                                                                                               
	"sap/m/Bar",                                                                                                                                                                                                                                                  
	"sap/m/Text",                                                                                                                                                                                                                                                 
	"sap/m/MessageToast",                                                                                                                                                                                                                                         
	"sap/ui/model/odata/v2/ODataModel",                                                                                                                                                                                                                           
	'sap/ui/core/format/DateFormat',                                                                                                                                                                                                                              
	"com/vistex/zagriplan/model/base"                                                                                                                                                                                                                             
], function (Controller, models, JSONModel, Device, History, MessageBox, gis, Link, MessageItem, MessageView, Button, Dialog, Bar,                                                                                                                             
	Text, MessageToast, ODataModel, DateFormat, base) {                                                                                                                                                                                                           
	"use strict";                                                                                                                                                                                                                                                 
                                                                                                                                                                                                                                                               
	return Controller.extend("com.vistex.zagriplan.controller.Detail3", {                                                                                                                                                                                         
                                                                                                                                                                                                                                                               
		/**                                                                                                                                                                                                                                                          
		 * Called when a controller is instantiated and its View controls (if available) are already created.                                                                                                                                                        
		 * Can be used to modify the View before it is displayed, to bind event handlers and do other one-time initialization.                                                                                                                                       
		 * @memberOf com.vistex.zagriplan.WebContent.view.Detail3                                                                                                                                                                                                    
		 */                                                                                                                                                                                                                                                          
		onInit: function () {                                                                                                                                                                                                                                        
			this._gm = sap.ui.getCore().getModel("gm");                                                                                                                                                                                                                 
			base.getEventBus().subscribe("map", "onClick", this.onClickMap, this);                                                                                                                                                                                      
			this.getOwnerComponent().getRouter().getRoute("Detail3").attachPatternMatched(this._onRouteMatched, this);                                                                                                                                                  
			this.setInitialData();                                                                                                                                                                                                                                      
		},                                                                                                                                                                                                                                                           
		setInitialData: function () {                                                                                                                                                                                                                                
			this.oModel = models.callBackEnd();                                                                                                                                                                                                                         
			var data1 = {                                                                                                                                                                                                                                               
				results: []                                                                                                                                                                                                                                                
			};                                                                                                                                                                                                                                                          
			var data2 = {                                                                                                                                                                                                                                               
				results: []                                                                                                                                                                                                                                                
			};                                                                                                                                                                                                                                                          
			var json1 = new JSONModel();                                                                                                                                                                                                                                
			json1.setData(data1);                                                                                                                                                                                                                                       
			this.oView.byId("table1").setModel(json1, "modelTabDisp");                                                                                                                                                                                                  
			var oFilters = [];                                                                                                                                                                                                                                          
			oFilters.push(new sap.ui.model.Filter("Acnum", "EQ", sap.ui.getCore().dadosMaster.Acnum));                                                                                                                                                                  
			oFilters.push(new sap.ui.model.Filter("Werks", "EQ", sap.ui.getCore().dadosMaster.Werks));                                                                                                                                                                  
			oFilters.push(new sap.ui.model.Filter("Matkl", "EQ", sap.ui.getCore().dadosDetail.Matkl));                                                                                                                                                                  
                                                                                                                                                                                                                                                               
			this.oModel.read("/GetVolumeCaldaSet", {                                                                                                                                                                                                                    
				filters: oFilters,                                                                                                                                                                                                                                         
				success: function (oData) {                                                                                                                                                                                                                                
					sap.ui.getCore().volumeCalda = oData.results;                                                                                                                                                                                                             
				}                                                                                                                                                                                                                                                          
			});                                                                                                                                                                                                                                                         
		},                                                                                                                                                                                                                                                           
		_onRouteMatched: function (oEvent) {                                                                                                                                                                                                                         
			this._gm.setProperty("/detail3/colSelDate", sap.ui.getCore().dataTalhao);                                                                                                                                                                                   
			this.onChangeMapTable(); // check map or table selected                                                                                                                                                                                                     
			this.checkSplitMode();                                                                                                                                                                                                                                      
			this.getTableData();                                                                                                                                                                                                                                        
		},                                                                                                                                                                                                                                                           
		getTableData: function () {                                                                                                                                                                                                                                  
			var thiz = this;                                                                                                                                                                                                                                            
			this._gm.setProperty("/detail3/selectedTerrains/", []); // clear selected Terrains                                                                                                                                                                          
			$.when(this.setTable1Data(), this.setTable2Data()).done(function (aData1, aData2) {                                                                                                                                                                         
				// prepare data for map table 2                                                                                                                                                                                                                            
				var aData = sap.ui.getCore().getModel("TerrainFP").getData(); // get model data from detail2                                                                                                                                                               
				var aMapData2 = thiz.getFillTerrainMapData(aData); // prepare data for fill terrain                                                                                                                                                                        
				var oMapData2 = {};                                                                                                                                                                                                                                        
				aMapData2.forEach(function (item) {                                                                                                                                                                                                                        
					oMapData2[item.terrain] = "";                                                                                                                                                                                                                             
				}); // create object for comparison                                                                                                                                                                                                                        
				// prepare data for border terrain                                                                                                                                                                                                                         
				var aMapData1 = [],                                                                                                                                                                                                                                        
					oMapData1 = {};                                                                                                                                                                                                                                           
				aData1.forEach(function (item) {                                                                                                                                                                                                                           
					if (!oMapData2.hasOwnProperty(item.Talhao)) {                                                                                                                                                                                                             
						if (!oMapData1.hasOwnProperty(item.Talhao)) { // if not duplicate then add                                                                                                                                                                               
							aMapData1.push({                                                                                                                                                                                                                                        
								terrain: item.Talhao,                                                                                                                                                                                                                                  
								color: "rgba(255,192,203,1)",                                                                                                                                                                                                                          
								firstHighlight: true                                                                                                                                                                                                                                   
							});                                                                                                                                                                                                                                                     
						}                                                                                                                                                                                                                                                        
					}                                                                                                                                                                                                                                                         
				});                                                                                                                                                                                                                                                        
				/*var data = aData1.forEach(function(item){                                                                                                                                                                                                                
					return item.Talhao;                                                                                                                                                                                                                                       
				});                                                                                                                                                                                                                                                        
				aData1 = data.filter(function(item, pos, self) { return self.indexOf(item) === pos; });                                                                                                                                                                    
				aData1 = aData1.map(function(item){ return {terrain : item, color:"rgba(255,192,203,1)", firstHighlight:true };   });*/                                                                                                                                    
				thiz.showMap(aMapData1, aMapData2); // call show map                                                                                                                                                                                                       
			});                                                                                                                                                                                                                                                         
		},                                                                                                                                                                                                                                                           
		///////////////////////////////////////// GIS ///////////////////////////////////////////////                                                                                                                                                                
		/* on click GIS Map */                                                                                                                                                                                                                                       
		onClickMap: function (ch, ev, data) {                                                                                                                                                                                                                        
			console.log("click", data);                                                                                                                                                                                                                                 
			if (data.isFill) {                                                                                                                                                                                                                                          
				alert("Select valid terrain");                                                                                                                                                                                                                             
				return;                                                                                                                                                                                                                                                    
			}                                                                                                                                                                                                                                                           
			if (!data.isFill && data.isBorder) { // check only highlighted terrain                                                                                                                                                                                      
				//gis.unSetTerrainBorderColor(null,[{terrain:data.terrain}]);                                                                                                                                                                                              
				if (data.oBorder.firstHighlight) { // if true means pink valid terrain to select&nbsp;                                                                                                                                                                     
					gis.setTerrainBorderColor(null, [{                                                                                                                                                                                                                        
						terrain: data.terrain,                                                                                                                                                                                                                                   
						color: "rgba(0,0,255,1)",                                                                                                                                                                                                                                
						firstHighlight: false                                                                                                                                                                                                                                    
					}]); // blue                                                                                                                                                                                                                                              
				} else { // make it as pink again                                                                                                                                                                                                                          
					gis.setTerrainBorderColor(null, [{                                                                                                                                                                                                                        
						terrain: data.terrain,                                                                                                                                                                                                                                   
						color: "rgba(255,192,203,1)",                                                                                                                                                                                                                            
						firstHighlight: true                                                                                                                                                                                                                                     
					}]); // pink                                                                                                                                                                                                                                              
				}                                                                                                                                                                                                                                                          
			}                                                                                                                                                                                                                                                           
			//this._gm.setProperty("/detail3/selectedTerrains/",data.highlighted); // save highlighted terrain                                                                                                                                                          
		},                                                                                                                                                                                                                                                           
		showMap: function (aData1, aData2) {                                                                                                                                                                                                                         
			gis.initMap(this.createId("map"), this.createId("loadingImg"), function (map) {                                                                                                                                                                             
				gis.clearGraphics(map); // clear previous graphics                                                                                                                                                                                                         
				gis.showFarm(aData1[0].terrain.split("-")[0]); // focus on farm                                                                                                                                                                                            
				gis.setTerrainBorderColor(map, aData1); // set border for terrains&nbsp;&nbsp;                                                                                                                                                                             
				gis.fillTerrains(map, aData2); // fill selected terrain                                                                                                                                                                                                    
			});                                                                                                                                                                                                                                                         
		},                                                                                                                                                                                                                                                           
		/* on segement change for map and table */                                                                                                                                                                                                                   
		onChangeMapTable: function () {                                                                                                                                                                                                                              
			//var key = oEvent.getParameter("item").getKey();                                                                                                                                                                                                           
			var key = this._gm.getProperty("/detail3/sMapTable", key);                                                                                                                                                                                                  
			if (key === "map") {                                                                                                                                                                                                                                        
				$("#" + this.createId("map")).css("display", "initial");                                                                                                                                                                                                   
			} else {                                                                                                                                                                                                                                                    
				$("#" + this.createId("map")).css("display", "none");                                                                                                                                                                                                      
			}                                                                                                                                                                                                                                                           
		},                                                                                                                                                                                                                                                           
		getFillTerrainMapData: function (aTerrain1) {                                                                                                                                                                                                                
			var thiz = this;                                                                                                                                                                                                                                            
			var aTerrain = JSON.parse(JSON.stringify(aTerrain1));                                                                                                                                                                                                       
			var aMapData2 = [];                                                                                                                                                                                                                                         
			var aData = sap.ui.getCore().getModel("TerrainFP").getData(); // get model data from detail2                                                                                                                                                                
			var sSelDate = this._gm.getProperty("/detail3/colSelDate"); // get selected date from detail2                                                                                                                                                               
			aData.forEach(function (item) {                                                                                                                                                                                                                             
				if (item.Begda === sSelDate) {                                                                                                                                                                                                                             
					if (item.hasOwnProperty("Full") && item.Full === "X") { // if Full give green color                                                                                                                                                                       
						aMapData2.push({                                                                                                                                                                                                                                         
							terrain: item.TplnrFl,                                                                                                                                                                                                                                  
							color: "rgba(0,255,0,0.5)"                                                                                                                                                                                                                              
						});                                                                                                                                                                                                                                                      
					} else if (item.hasOwnProperty("Partial") && item.Partial === "X") { // if partial give blue color                                                                                                                                                        
						aMapData2.push({                                                                                                                                                                                                                                         
							terrain: item.TplnrFl,                                                                                                                                                                                                                                  
							color: "rgba(0,0,255,0.5)"                                                                                                                                                                                                                              
						});                                                                                                                                                                                                                                                      
					}                                                                                                                                                                                                                                                         
				}                                                                                                                                                                                                                                                          
			});                                                                                                                                                                                                                                                         
			if (aTerrain) {                                                                                                                                                                                                                                             
				var oTerrain = {};                                                                                                                                                                                                                                         
				aTerrain.forEach(function (item) {                                                                                                                                                                                                                         
					oTerrain[item.TplnrFl] = "";                                                                                                                                                                                                                              
				}); // convert into object                                                                                                                                                                                                                                 
				aMapData2 = aMapData2.filter(function (item) {                                                                                                                                                                                                             
					return oTerrain.hasOwnProperty(item.terrain);                                                                                                                                                                                                             
				}); // filter by terrain                                                                                                                                                                                                                                   
			}                                                                                                                                                                                                                                                           
			return aMapData2;                                                                                                                                                                                                                                           
		},                                                                                                                                                                                                                                                           
		///////////////////////////////////////// END OF GIS ///////////////////////////////////////////////                                                                                                                                                         
                                                                                                                                                                                                                                                               
		setTable1Data: function () {                                                                                                                                                                                                                                 
			var that = this;                                                                                                                                                                                                                                            
			var deferred = jQuery.Deferred();                                                                                                                                                                                                                           
			this.oModel = models.callBackEnd();                                                                                                                                                                                                                         
			this.oView.byId("idArea").setText(sap.ui.getCore().dadosMaster.Acdes);                                                                                                                                                                                      
			this.oView.byId("idCentro").setText(sap.ui.getCore().dadosMaster.Werks);                                                                                                                                                                                    
			this.oView.byId("idSafra").setText(sap.ui.getCore().dadosMaster.Ajahr);                                                                                                                                                                                     
			this.oView.byId("idProc").setText(sap.ui.getCore().dadosProcesso);                                                                                                                                                                                          
			this.oView.byId("idTask").setText(sap.ui.getCore().dadosDetail.Wgbez);                                                                                                                                                                                      
			this.oView.byId("idData").setText(sap.ui.getCore().dataTalhao);                                                                                                                                                                                             
			this.oFilters1 = [];                                                                                                                                                                                                                                        
			this.oFilters1.push(new sap.ui.model.Filter("Acnum", "EQ", sap.ui.getCore().dadosMaster.Acnum));                                                                                                                                                            
			var data2 = [];                                                                                                                                                                                                                                             
			this.oModel.read("/GetTerrenoSet", {                                                                                                                                                                                                                        
				filters: that.oFilters1,                                                                                                                                                                                                                                   
				success: function (oData) {                                                                                                                                                                                                                                
					if (sap.ui.getCore().selectedTalhao.results.length < 0) {                                                                                                                                                                                                 
						for (var x = 0; x < oData.results.length; x++) {                                                                                                                                                                                                         
							for (var y = 0; y < sap.ui.getCore().volumeCalda.length; y++) {                                                                                                                                                                                         
								if (oData.results[x].TplnrFl === sap.ui.getCore().volumeCalda[y].TplnrFl) {                                                                                                                                                                            
									oData.results[x].Aarea = sap.ui.getCore().volumeCalda[y].Acarx;                                                                                                                                                                                       
									break;                                                                                                                                                                                                                                                
								}                                                                                                                                                                                                                                                      
							}                                                                                                                                                                                                                                                       
						}                                                                                                                                                                                                                                                        
					} else {                                                                                                                                                                                                                                                  
						for (var x = 0; x < sap.ui.getCore().selectedTalhao.results.length; x++) {                                                                                                                                                                               
							if (sap.ui.getCore().volumeCalda){                                                                                                                                                                                                                      
							for (var y = 0; y < sap.ui.getCore().volumeCalda.length; y++) {                                                                                                                                                                                         
								if (sap.ui.getCore().selectedTalhao.results[x].TplnrFl === sap.ui.getCore().volumeCalda[y].TplnrFl) {                                                                                                                                                  
									sap.ui.getCore().selectedTalhao.results[x].Aarea = sap.ui.getCore().volumeCalda[y].Acarx;                                                                                                                                                             
									break;                                                                                                                                                                                                                                                
								}                                                                                                                                                                                                                                                      
							}                                                                                                                                                                                                                                                       
						  }                                                                                                                                                                                                                                                      
						}                                                                                                                                                                                                                                                        
                                                                                                                                                                                                                                                               
					}                                                                                                                                                                                                                                                         
					var json = new JSONModel();                                                                                                                                                                                                                               
					json.setData(oData);                                                                                                                                                                                                                                      
					that.oView.byId("table1").getModel("modelTabDisp").setData(oData);                                                                                                                                                                                        
					that.oView.byId("table1").getModel("modelTabDisp").refresh();                                                                                                                                                                                             
					deferred.resolve(oData.results);                                                                                                                                                                                                                          
				}                                                                                                                                                                                                                                                          
			});                                                                                                                                                                                                                                                         
			return deferred.promise();                                                                                                                                                                                                                                  
		},                                                                                                                                                                                                                                                           
		setTable2Data: function () {                                                                                                                                                                                                                                 
			var that = this;                                                                                                                                                                                                                                            
			var deferred = jQuery.Deferred();                                                                                                                                                                                                                           
			var oFilters = [];                                                                                                                                                                                                                                          
			oFilters.push(new sap.ui.model.Filter("Acnum", "EQ", sap.ui.getCore().dadosMaster.Acnum));                                                                                                                                                                  
			oFilters.push(new sap.ui.model.Filter("Extwg", "EQ", sap.ui.getCore().dadosProcessoId));                                                                                                                                                                    
			oFilters.push(new sap.ui.model.Filter("Matkl", "EQ", sap.ui.getCore().dadosDetail.Matkl));                                                                                                                                                                  
			oFilters.push(new sap.ui.model.Filter("Data", "EQ", sap.ui.getCore().Data));                                                                                                                                                                                
                                                                                                                                                                                                                                                               
			this.oModel.read("/SetProgTalhaoSet", {                                                                                                                                                                                                                     
				filters: oFilters,                                                                                                                                                                                                                                         
				success: function (oData) {                                                                                                                                                                                                                                
					var table2 = [];                                                                                                                                                                                                                                          
					for (var x = 0; x < oData.results.length; x++) {                                                                                                                                                                                                          
						var line = {};                                                                                                                                                                                                                                           
						line.Talhao = oData.results[x].TplnrFl;                                                                                                                                                                                                                  
						line.Cmnum = oData.results[x].Cmnum;                                                                                                                                                                                                                     
						line.Aarea = oData.results[x].Aarea;                                                                                                                                                                                                                     
						line.Data = oData.results[x].Data;                                                                                                                                                                                                                       
						line.Rcnum = oData.results[x].Rcnum;                                                                                                                                                                                                                     
						line.Aufnr = oData.results[x].Aufnr;                                                                                                                                                                                                                     
						line.Loevm = oData.results[x].Loevm;                                                                                                                                                                                                                     
						line.Status = oData.results[x].Status;                                                                                                                                                                                                                   
						table2.push(line);                                                                                                                                                                                                                                       
					}                                                                                                                                                                                                                                                         
					var json1 = new JSONModel();                                                                                                                                                                                                                              
					json1.setData({                                                                                                                                                                                                                                           
						table2: table2                                                                                                                                                                                                                                           
					});                                                                                                                                                                                                                                                       
					that.oView.byId("table2").setModel(json1);                                                                                                                                                                                                                
					//	that.oView.byId("table2").setModel(json2);                                                                                                                                                                                                             
					var tableM = that.oView.byId("table2").getModel().getData().table2;                                                                                                                                                                                       
					tableM.forEach(function (item) {                                                                                                                                                                                                                          
						if (item.Status === "X") {                                                                                                                                                                                                                               
							item.Status = "X";                                                                                                                                                                                                                                      
							//tableM.setProperty("/Status","X");                                                                                                                                                                                                                    
						}                                                                                                                                                                                                                                                        
                                                                                                                                                                                                                                                               
					});                                                                                                                                                                                                                                                       
					that.oView.byId("table2").bindRows("/table2");                                                                                                                                                                                                            
					deferred.resolve(table2);                                                                                                                                                                                                                                 
				}                                                                                                                                                                                                                                                          
			});                                                                                                                                                                                                                                                         
			return deferred.promise();                                                                                                                                                                                                                                  
		},                                                                                                                                                                                                                                                           
		moveToTable2: function () {                                                                                                                                                                                                                                  
			//for(var i=0;i<2;i++){ gis.fillTerrains(null,[{ terrain : "219720-0027"+i, color:"rgba(0,255,0,0.5)" }]);}                                                                                                                                                 
			var thiz = this;                                                                                                                                                                                                                                            
			var oTable1 = this.oView.byId("table1");                                                                                                                                                                                                                    
			var oTable2 = this.oView.byId("table2");                                                                                                                                                                                                                    
			var aData2 = oTable2.getModel().getProperty("/table2");                                                                                                                                                                                                     
			var aDuplicateTerrain = [];                                                                                                                                                                                                                                 
			var aIndex = [];                                                                                                                                                                                                                                            
			if (this._gm.getProperty("/detail3/sMapTable") === "table") { // if table is selected then use table                                                                                                                                                        
				aIndex = oTable1.getSelectedIndices();                                                                                                                                                                                                                     
			} else {                                                                                                                                                                                                                                                    
				var oSelObj = gis.getHighlightedTerrainByParam({                                                                                                                                                                                                           
					firstHighlight: false                                                                                                                                                                                                                                     
				});                                                                                                                                                                                                                                                        
				var aData = oTable1.getModel("modelTabDisp").getProperty("/results"); // get table1 data                                                                                                                                                                   
				aData.forEach(function (item, i) {                                                                                                                                                                                                                         
					if (oSelObj.oTerrains.hasOwnProperty(item.Talhao)) {                                                                                                                                                                                                      
						aIndex.push(i);                                                                                                                                                                                                                                          
					} // collect all index available in selected terrain                                                                                                                                                                                                      
				});                                                                                                                                                                                                                                                        
			}                                                                                                                                                                                                                                                           
			aIndex.forEach(function (index, i) {                                                                                                                                                                                                                        
				var oContext = oTable1.getContextByIndex(aIndex[i]); // get selected context                                                                                                                                                                               
				var sTalhao = oContext.getProperty("Talhao"); // get terrain                                                                                                                                                                                               
				if (!thiz.isDuplicateRecord(sTalhao)) { // if duplicate record not found then add that record                                                                                                                                                              
					var obj = oContext.getProperty(oContext.getPath());                                                                                                                                                                                                       
					obj.Data = sap.ui.getCore().Data;                                                                                                                                                                                                                         
					aData2.push(obj); // copy that record in table2                                                                                                                                                                                                           
					gis.fillTerrains(null, [{                                                                                                                                                                                                                                 
						terrain: obj.Talhao,                                                                                                                                                                                                                                     
						color: "rgba(0,0,255,0.5)",                                                                                                                                                                                                                              
						firstHighlight: true                                                                                                                                                                                                                                     
					}]); // fill selected terrain&nbsp;                                                                                                                                                                                                                       
					gis.unSetTerrainBorderColor(null, [{                                                                                                                                                                                                                      
						terrain: obj.Talhao,                                                                                                                                                                                                                                     
						firstHighlight: true                                                                                                                                                                                                                                     
					}]); // fill selected terrain                                                                                                                                                                                                                             
				} else {                                                                                                                                                                                                                                                   
					//gis.unSetTerrainBorderColor(null,[{ terrain : sTalhao,firstHighlight:true }]);     // fill selected terrain                                                                                                                                             
					aDuplicateTerrain.push(sTalhao); // if duplicate then save that terrain for further validation                                                                                                                                                            
				}                                                                                                                                                                                                                                                          
			});                                                                                                                                                                                                                                                         
			oTable2.getModel().refresh();                                                                                                                                                                                                                               
			if (aDuplicateTerrain.length > 0) { // if any duplicate record found then show that in message                                                                                                                                                              
				MessageBox.error("Duplicate Record found " + aDuplicateTerrain.join(", "));                                                                                                                                                                                
			}                                                                                                                                                                                                                                                           
			oTable1.setSelectedIndex(-1);                                                                                                                                                                                                                               
		},                                                                                                                                                                                                                                                           
		moveToTable1: function (oEvent) {                                                                                                                                                                                                                            
			var tab1 = this.oView.byId("table1");                                                                                                                                                                                                                       
			var tab2 = this.oView.byId("table2");                                                                                                                                                                                                                       
			var array = this.oView.byId("table2").getModel().getData().table2;                                                                                                                                                                                          
			var aIndices = tab2.getSelectedIndices();                                                                                                                                                                                                                   
			var aTerrain = [];                                                                                                                                                                                                                                          
			aIndices.forEach(function (i) {                                                                                                                                                                                                                             
				aTerrain.push({                                                                                                                                                                                                                                            
					terrain: array[i].Talhao                                                                                                                                                                                                                                  
				});                                                                                                                                                                                                                                                        
			});                                                                                                                                                                                                                                                         
			var indices = aIndices.sort(function (a, b) {                                                                                                                                                                                                               
				return b - a;                                                                                                                                                                                                                                              
			});                                                                                                                                                                                                                                                         
			for (var x = 0; x < indices.length; x++) {                                                                                                                                                                                                                  
				tab2.getModel().getData().table2.splice(indices[x], 1);                                                                                                                                                                                                    
				tab2.getModel().refresh();                                                                                                                                                                                                                                 
			}                                                                                                                                                                                                                                                           
			tab1.setSelectedIndex(-1);                                                                                                                                                                                                                                  
			tab2.setSelectedIndex(-1);                                                                                                                                                                                                                                  
			gis.clearFillTerrains(null, aTerrain);                                                                                                                                                                                                                      
			var aBTerrain = aTerrain.map(function (item) {                                                                                                                                                                                                              
				item.color = "rgba(255,192,203,1)";                                                                                                                                                                                                                        
				item.firstHighlight = true;                                                                                                                                                                                                                                
				return item;                                                                                                                                                                                                                                               
			});                                                                                                                                                                                                                                                         
			gis.setTerrainBorderColor(null, aBTerrain);                                                                                                                                                                                                                 
		},                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
		moveUp: function (oEvent) {                                                                                                                                                                                                                                  
			var tab = this.oView.byId("table2");                                                                                                                                                                                                                        
			var line = tab.getSelectedIndex();                                                                                                                                                                                                                          
			var arr = tab.getModel("modelSelect").getData().results;                                                                                                                                                                                                    
			this.array_move(arr, line, line - 1);                                                                                                                                                                                                                       
			tab.setSelectedIndex(line - 1);                                                                                                                                                                                                                             
			tab.getModel("modelSelect").refresh();                                                                                                                                                                                                                      
		},                                                                                                                                                                                                                                                           
		moveDown: function (oEvent) {                                                                                                                                                                                                                                
			var tab = this.oView.byId("table2");                                                                                                                                                                                                                        
			var line = tab.getSelectedIndex();                                                                                                                                                                                                                          
			var arr = tab.getModel("modelSelect").getData().results;                                                                                                                                                                                                    
			this.array_move(arr, line, line + 1);                                                                                                                                                                                                                       
			tab.setSelectedIndex(line + 1);                                                                                                                                                                                                                             
			tab.getModel("modelSelect").refresh();                                                                                                                                                                                                                      
		},                                                                                                                                                                                                                                                           
		checkSplitMode: function () {                                                                                                                                                                                                                                
			if (this.oView.getParent().getParent().getMode() === sap.m.SplitAppMode.HideMode) {                                                                                                                                                                         
				this.oView.byId("idFull").setVisible(false);                                                                                                                                                                                                               
				this.oView.byId("idExit").setVisible(true);                                                                                                                                                                                                                
			} else if (this.oView.getParent().getParent().getMode() === sap.m.SplitAppMode.ShowHideMode) {                                                                                                                                                              
				this.oView.byId("idFull").setVisible(true);                                                                                                                                                                                                                
				this.oView.byId("idExit").setVisible(false);                                                                                                                                                                                                               
			}                                                                                                                                                                                                                                                           
		},                                                                                                                                                                                                                                                           
		onFullScreen: function (oEvent) {                                                                                                                                                                                                                            
			switch (oEvent.getSource().sId.split('-')[2]) {                                                                                                                                                                                                             
			case "idFull":                                                                                                                                                                                                                                              
				this.getView().getParent().getParent().setMode(sap.m.SplitAppMode.HideMode);                                                                                                                                                                               
				this.oView.byId("idFull").setVisible(false);                                                                                                                                                                                                               
				this.oView.byId("idExit").setVisible(true);                                                                                                                                                                                                                
				break;                                                                                                                                                                                                                                                     
			case "idExit":                                                                                                                                                                                                                                              
				this.getView().getParent().getParent().setMode(sap.m.SplitAppMode.ShowHideMode);                                                                                                                                                                           
				this.oView.byId("idExit").setVisible(false);                                                                                                                                                                                                               
				this.oView.byId("idFull").setVisible(true);                                                                                                                                                                                                                
				break;                                                                                                                                                                                                                                                     
			default:                                                                                                                                                                                                                                                    
			}                                                                                                                                                                                                                                                           
		},                                                                                                                                                                                                                                                           
		/**&nbsp;                                                                                                                                                                                                                                                    
         * Filter/Search Table by Column. Common for all Tables.                                                                                                                                                                                               
         * @param {object} oEvent - Object of the source control.&nbsp;                                                                                                                                                                                        
         * @public                                                                                                                                                                                                                                             
         */                                                                                                                                                                                                                                                    
        onFilterInsumos: function(oEvent) {                                                                                                                                                                                                                    
        	var that = this;                                                                                                                                                                                                                                      
        	var tableId = that.byId(sap.ui.core.Fragment.createId("idFrag", "idTabProd"))                                                                                                                                                                         
            var value = oEvent.getSource().getValue();                                                                                                                                                                                                         
            var columns = tableId.getColumns();                                                                                                                                                                                                                
            var len = columns.length;                                                                                                                                                                                                                          
            var oFilter = [];                                                                                                                                                                                                                                  
            var content = sap.ui.model.FilterOperator.Contains;                                                                                                                                                                                                
            for (var i = 0; i < len; i++) {                                                                                                                                                                                                                    
                var columnname = columns[i].getFilterProperty();                                                                                                                                                                                               
                if (columnname !== "") {                                                                                                                                                                                                                       
                    oFilter.push(new sap.ui.model.Filter(columnname, content, value));                                                                                                                                                                         
                }                                                                                                                                                                                                                                              
            }                                                                                                                                                                                                                                                  
            var allFilters = new sap.ui.model.Filter(oFilter, false);                                                                                                                                                                                          
            tableId.getBinding("rows").filter(allFilters);                                                                                                                                                                                                     
        },                                                                                                                                                                                                                                                     
        /**&nbsp;                                                                                                                                                                                                                                              
         * Filter/Search Table by Column. Common for all Tables.                                                                                                                                                                                               
         * @param {object} oEvent - Object of the source control.&nbsp;                                                                                                                                                                                        
         * @public                                                                                                                                                                                                                                             
         */                                                                                                                                                                                                                                                    
        onFilterInsumosim: function(oEvent) {                                                                                                                                                                                                                  
        	var that = this;                                                                                                                                                                                                                                      
        	var tableId = that.byId(sap.ui.core.Fragment.createId("idFrag", "idTabProdSimilar"))                                                                                                                                                                  
            var value = oEvent.getSource().getValue();                                                                                                                                                                                                         
            var columns = tableId.getColumns();                                                                                                                                                                                                                
            var len = columns.length;                                                                                                                                                                                                                          
            var oFilter = [];                                                                                                                                                                                                                                  
            var content = sap.ui.model.FilterOperator.Contains;                                                                                                                                                                                                
            for (var i = 0; i < len; i++) {                                                                                                                                                                                                                    
                var columnname = columns[i].getFilterProperty();                                                                                                                                                                                               
                if (columnname !== "") {                                                                                                                                                                                                                       
                    oFilter.push(new sap.ui.model.Filter(columnname, content, value));                                                                                                                                                                         
                }                                                                                                                                                                                                                                              
            }                                                                                                                                                                                                                                                  
            var allFilters = new sap.ui.model.Filter(oFilter, false);                                                                                                                                                                                          
            tableId.getBinding("rows").filter(allFilters);                                                                                                                                                                                                     
        },                                                                                                                                                                                                                                                     
		/* ------------- ADD/EDIT/DELETE ---------------------- */                                                                                                                                                                                                   
		sPath: null,                                                                                                                                                                                                                                                 
		/**&nbsp;                                                                                                                                                                                                                                                    
		 * Sends data from selected table row to be added to details model.                                                                                                                                                                                          
		 * @param {object} oEvent - Object of the source control.&nbsp;                                                                                                                                                                                              
		 */                                                                                                                                                                                                                                                          
		onTableRowSelect: function (oEvent) {                                                                                                                                                                                                                        
			if (!oEvent || oEvent.getSource().getSelectedIndex() === -1) {                                                                                                                                                                                              
				return;                                                                                                                                                                                                                                                    
			}                                                                                                                                                                                                                                                           
			this.sPath = oEvent.getSource().getContextByIndex(oEvent.getSource().getSelectedIndex()).getPath();                                                                                                                                                         
                                                                                                                                                                                                                                                               
		},                                                                                                                                                                                                                                                           
		onDelete: function (oEvent) {                                                                                                                                                                                                                                
			var tableId = this.getView().byId("table2"); // get table id                                                                                                                                                                                                
			var tab2 = this.oView.byId("table2").getSelectedIndices(); // get the selected index                                                                                                                                                                        
			var msgSelOneRow = "selecione um registro";                                                                                                                                                                                                                 
			var msgTitle = this.getText("infoTitle");                                                                                                                                                                                                                   
			var sAufnr;                                                                                                                                                                                                                                                 
			//	var aIndex = tableId.getSelectedIndices();                                                                                                                                                                                                               
			tab2.forEach(function (index, i) {                                                                                                                                                                                                                          
				var oContext = tableId.getContextByIndex(tab2[i]); // get context                                                                                                                                                                                          
				sAufnr = oContext.getProperty("Aufnr");                                                                                                                                                                                                                    
			});                                                                                                                                                                                                                                                         
			//Sequeira                                                                                                                                                                                                                                                  
			var thiz = this;                                                                                                                                                                                                                                            
			if (tab2.length === 0) {                                                                                                                                                                                                                                    
				MessageBox.show(msgSelOneRow, {                                                                                                                                                                                                                            
					title: msgTitle,                                                                                                                                                                                                                                          
					icon: MessageBox.Icon.INFORMATION                                                                                                                                                                                                                         
				});                                                                                                                                                                                                                                                        
				return;                                                                                                                                                                                                                                                    
			}                                                                                                                                                                                                                                                           
            //Check before delete...                                                                                                                                                                                                                           
            var stop = false;                                                                                                                                                                                                                                  
            //Prepare array...                                                                                                                                                                                                                                 
            var arrlist = [];                                                                                                                                                                                                                                  
			tab2.forEach(function (index, i) {                                                                                                                                                                                                                          
				var oContext = tableId.getContextByIndex(tab2[i]); // get context                                                                                                                                                                                          
				sAufnr = oContext.getProperty("Aufnr");                                                                                                                                                                                                                    
				var Talhao = oContext.getProperty("Talhao");&nbsp;                                                                                                                                                                                                         
				var Data   = oContext.getProperty("Data");                                                                                                                                                                                                                 
				var obj = {};                                                                                                                                                                                                                                              
				obj.Talhao = Talhao;                                                                                                                                                                                                                                       
				obj.Data   = Data;                                                                                                                                                                                                                                         
				arrlist.push(obj);                                                                                                                                                                                                                                         
				if (sAufnr){                                                                                                                                                                                                                                               
                 stop = true;&nbsp;&nbsp;&nbsp;                                                                                                                                                                                                                
				}                                                                                                                                                                                                                                                          
			});                                                                                                                                                                                                                                                         
            if (stop){                                                                                                                                                                                                                                         
				var msgCondition = "1 ou mais itens no podem ser excludos porque a ordem das tarefas est disponvel";                                                                                                                                                   
				MessageBox.show(msgCondition, {                                                                                                                                                                                                                            
					title: msgTitle,                                                                                                                                                                                                                                          
					icon: MessageBox.Icon.INFORMATION                                                                                                                                                                                                                         
				});                                                                                                                                                                                                                                                        
				return;            	                                                                                                                                                                                                                                       
            }                                                                                                                                                                                                                                                  
            //Now we delete it...                                                                                                                                                                                                                              
            var newModel = new sap.ui.model.json.JSONModel();                                                                                                                                                                                                  
			sap.ui.getCore().setModel(newModel, "deleteM");&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                                                                                                                                           
            var oModel = tableId.getModel().getData().table2;                                                                                                                                                                                                  
			sap.ui.getCore().getModel("deleteM").setData(JSON.parse(JSON.stringify(oModel)));&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                                                                                             
            var deleteModel = sap.ui.getCore().getModel("deleteM").getData();                                                                                                                                                                                  
			for (var i = 0; i < deleteModel.length; i++) {                                                                                                                                                                                                              
				var Terrain = deleteModel[i].Talhao;                                                                                                                                                                                                                       
				var Date = deleteModel[i].Data;				                                                                                                                                                                                                                        
				arrlist.forEach(function (item) {                                                                                                                                                                                                                          
				if (Terrain === item.Talhao && Date === item.Data) {                                                                                                                                                                                                       
					deleteModel[i].Loevm = "X";                                                                                                                                                                                                                               
				}&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                                                                                                                                                                                                          
				});                                                                                                                                                                                                                                                        
			}                                                                                                                                                                                                                                                           
			// Now slice...                                                                                                                                                                                                                                             
			arrlist.forEach(function (item) {                                                                                                                                                                                                                           
			    oModel.forEach(function (index, i) {                                                                                                                                                                                                                    
				var Terrain = oModel[i].Talhao;                                                                                                                                                                                                                            
				var Date = oModel[i].Data;				    	                                                                                                                                                                                                                        
			    if (Terrain === item.Talhao && Date === item.Data) {                                                                                                                                                                                                    
                   var deleteItem = oModel.splice(i, 1);                                                                                                                                                                                                       
			    }  			    									&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                                                                                                             
			   });				&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                                                                                                                                                                                                              
			});					                                                                                                                                                                                                                                                    
			this.delFlag = "X";                                                                                                                                                                                                                                         
			tableId.getModel().refresh();                                                                                                                                                                                                                               
			tableId.setSelectedIndex(-1);			&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                                                                                                                            
// 			if (tab2.length === 0) {                                                                                                                                                                                                                                 
// 				MessageBox.show(msgSelOneRow, {                                                                                                                                                                                                                         
// 					title: msgTitle,                                                                                                                                                                                                                                       
// 					icon: MessageBox.Icon.INFORMATION                                                                                                                                                                                                                      
// 				});                                                                                                                                                                                                                                                     
// 				//	var oTable2 = this.oView.byId("table2");                                                                                                                                                                                                             
                                                                                                                                                                                                                                                               
// 			} else if (sAufnr === "") {                                                                                                                                                                                                                              
// 				this.setSelectedTableItem(this.sPath, "delete");                                                                                                                                                                                                        
                                                                                                                                                                                                                                                               
// 			} else {                                                                                                                                                                                                                                                 
// 				var msgCondition = "No pode ser excludo porque a ordem das tarefas est disponvel";                                                                                                                                                                  
// 				MessageBox.show(msgCondition, {                                                                                                                                                                                                                         
// 					title: msgTitle,                                                                                                                                                                                                                                       
// 					icon: MessageBox.Icon.INFORMATION                                                                                                                                                                                                                      
// 				});                                                                                                                                                                                                                                                     
// 				return;                                                                                                                                                                                                                                                 
// 			}                                                                                                                                                                                                                                                        
            //Sequeira                                                                                                                                                                                                                                         
                                                                                                                                                                                                                                                               
		},                                                                                                                                                                                                                                                           
		delFlag: "",                                                                                                                                                                                                                                                 
		setSelectedTableItem: function (sPath, type) {                                                                                                                                                                                                               
			var tab = this.oView.byId("table2");                                                                                                                                                                                                                        
			var oModel = tab.getModel().getData().table2;                                                                                                                                                                                                               
			var newModel = new sap.ui.model.json.JSONModel();                                                                                                                                                                                                           
			sap.ui.getCore().setModel(newModel, "deleteM");                                                                                                                                                                                                             
			sap.ui.getCore().getModel("deleteM").setData(JSON.parse(JSON.stringify(oModel)));                                                                                                                                                                           
			var indexs = sPath.split("/");                                                                                                                                                                                                                              
			var index = indexs[indexs.length - 1];                                                                                                                                                                                                                      
			var deleteItem = oModel.splice(index, 1);                                                                                                                                                                                                                   
			var deleteModel = sap.ui.getCore().getModel("deleteM").getData();                                                                                                                                                                                           
			for (var i = 0; i < deleteModel.length; i++) {                                                                                                                                                                                                              
				var Terrain = deleteModel[i].Talhao;                                                                                                                                                                                                                       
				var Date = deleteModel[i].Data;                                                                                                                                                                                                                            
				if (deleteItem[0].Talhao === Terrain && deleteItem[0].Data === Date) {                                                                                                                                                                                     
					deleteModel[i].Loevm = "X";                                                                                                                                                                                                                               
					this.delFlag = "X";                                                                                                                                                                                                                                       
				}                                                                                                                                                                                                                                                          
			}                                                                                                                                                                                                                                                           
			tab.getModel().refresh();                                                                                                                                                                                                                                   
			tab.setSelectedIndex(-1);                                                                                                                                                                                                                                   
                                                                                                                                                                                                                                                               
		},                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
		onNavBack: function () {                                                                                                                                                                                                                                     
			var sPreviousHash = History.getInstance().getPreviousHash();                                                                                                                                                                                                
                                                                                                                                                                                                                                                               
			if (sPreviousHash !== undefined) {                                                                                                                                                                                                                          
				window.history.go(-1);                                                                                                                                                                                                                                     
			} else {                                                                                                                                                                                                                                                    
				this.getOwnerComponent().getRouter()                                                                                                                                                                                                                       
					.navTo("Detail2", {                                                                                                                                                                                                                                       
						Acnum: sap.ui.getCore().dadosMaster.Acnum                                                                                                                                                                                                                
					}, !Device.system.phone);                                                                                                                                                                                                                                 
			}                                                                                                                                                                                                                                                           
		},                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
		array_move: function (arr, old_index, new_index) {                                                                                                                                                                                                           
			if (new_index >= arr.length) {                                                                                                                                                                                                                              
				var k = new_index - arr.length + 1;                                                                                                                                                                                                                        
				while (k--) {                                                                                                                                                                                                                                              
					arr.push(undefined);                                                                                                                                                                                                                                      
				}                                                                                                                                                                                                                                                          
			}                                                                                                                                                                                                                                                           
			arr.splice(new_index, 0, arr.splice(old_index, 1)[0]);                                                                                                                                                                                                      
			return arr; // for testing                                                                                                                                                                                                                                  
		},                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
		moveToTable21: function (oEvent) {                                                                                                                                                                                                                           
			var tab1 = this.oView.byId("table1");                                                                                                                                                                                                                       
			var tab2 = this.oView.byId("table2");                                                                                                                                                                                                                       
			for (var x = 0; x < tab1.getSelectedIndices().length; x++) {                                                                                                                                                                                                
				var data1 = tab1.getModel("modelTabDisp").getData().results[tab1.getSelectedIndices()[x]];                                                                                                                                                                 
				data1.Data = sap.ui.getCore().Data;                                                                                                                                                                                                                        
				var table2 = tab2.getModel().getData().table2;                                                                                                                                                                                                             
				for (var i = 0; i < table2.length; i++) {                                                                                                                                                                                                                  
					if (table2[i].Talhao !== data1.Talhao) {                                                                                                                                                                                                                  
						tab2.getModel().getData().table2.push(data1);                                                                                                                                                                                                            
					} else {                                                                                                                                                                                                                                                  
						MessageBox.success("Duplicate Record", {});                                                                                                                                                                                                              
					}                                                                                                                                                                                                                                                         
				}                                                                                                                                                                                                                                                          
				tab2.getModel().refresh();                                                                                                                                                                                                                                 
				tab1.setSelectedIndex(-1);                                                                                                                                                                                                                                 
				tab2.setSelectedIndex(-1);                                                                                                                                                                                                                                 
			}                                                                                                                                                                                                                                                           
		},                                                                                                                                                                                                                                                           
		onDeleteInsumos : function(oEvent){                                                                                                                                                                                                                          
			var oInsumosTable = this.byId(sap.ui.core.Fragment.createId("idFrag", "idTabProd"));                                                                                                                                                                        
			var oModel = this.byId(sap.ui.core.Fragment.createId("idFrag", "idTabProd")).getModel();                                                                                                                                                                    
			 var receitaModel = oModel.getData().receitaLista;                                                                                                                                                                                                          
			var aIndex = oInsumosTable.getSelectedIndices();                                                                                                                                                                                                            
			var arr = [];                                                                                                                                                                                                                                               
			var len = aIndex.length;			                                                                                                                                                                                                                                 
			aIndex.forEach(function (index, i) {                                                                                                                                                                                                                        
				var oContext = oInsumosTable.getContextByIndex(aIndex[i]); // get context                                                                                                                                                                                  
				//var loevm = oContext.getModel().setProperty(oContext.sPath + "/Loevm","X");                                                                                                                                                                              
				oContext.getModel().setProperty("/receitaLista/" + aIndex[i] + "/Loevm","X");                                                                                                                                                                              
				var selectedData = oContext.getModel().getProperty("/receitaLista/" + aIndex[i]);                                                                                                                                                                          
	             arr.push(selectedData);                                                                                                                                                                                                                          
			});                                                                                                                                                                                                                                                         
			console.log(arr);                                                                                                                                                                                                                                           
		},                                                                                                                                                                                                                                                           
		                                                                                                                                                                                                                                                             
		  onTbDelBtn: function(oEvent) {                                                                                                                                                                                                                             
				  var oModel1 = new ODataModel("/sap/opu/odata/sap/ZFARM_AGRIPLAN_SRV/");                                                                                                                                                                                  
			      var oTable = this.byId(sap.ui.core.Fragment.createId("idFrag", "idTabProd"));                                                                                                                                                                         
			      var terrenos = this.oView.byId("table2").getModel().getData().table2;                                                                                                                                                                                 
				  var receita = this.byId(sap.ui.core.Fragment.createId("idFrag", "idReceita"));                                                                                                                                                                           
			      var aSelIndex = oTable.getSelectedIndices();                                                                                                                                                                                                          
			      var arr= [];                                                                                                                                                                                                                                          
			    //  var sCozy = this.getOwnerComponent().getContentDensityClass();                                                                                                                                                                                      
			      //var oModel = oTable.getModel(oTable.getBindingInfo("rows").model);                                                                                                                                                                                  
			      var oBinding = oTable.getBindingInfo("rows");                                                                                                                                                                                                         
			      var oModel = oTable.getModel(oBinding.model);                                                                                                                                                                                                         
			      var aData = oModel.getProperty(oBinding.path);                                                                                                                                                                                                        
			      if (aSelIndex.length === 0) { // no selection                                                                                                                                                                                                         
			        MessageBox.show(new sap.m.Text({                                                                                                                                                                                                                    
			          text: "Selecione ao menos uma linha",                                                                                                                                                                                                             
			          textAlign: 'Center',                                                                                                                                                                                                                              
			          width: '100%'                                                                                                                                                                                                                                     
			        }), {                                                                                                                                                                                                                                               
			          title: "Information",                                                                                                                                                                                                                             
			          icon: MessageBox.Icon.INFORMATION,                                                                                                                                                                                                                
			         // styleClass: sCozy                                                                                                                                                                                                                               
			        });                                                                                                                                                                                                                                                 
			      } else {                                                                                                                                                                                                                                              
			        var fnDeleteRecord = function(oAction) {                                                                                                                                                                                                            
			          if (oAction === "OK") {                                                                                                                                                                                                                           
			            aSelIndex.sort(function(a, b) {                                                                                                                                                                                                                 
			              if (a < b) {                                                                                                                                                                                                                                  
			                return 1;                                                                                                                                                                                                                                   
			              } else if (a > b) {                                                                                                                                                                                                                           
			                return -1;                                                                                                                                                                                                                                  
			              } else {                                                                                                                                                                                                                                      
			                return 0;                                                                                                                                                                                                                                   
			              }                                                                                                                                                                                                                                             
			            });                                                                                                                                                                                                                                             
			            aSelIndex.forEach(function(index) {                                                                                                                                                                                                             
			            	 //Sequeira                                                                                                                                                                                                                                    
				              var sPath1 = oTable.getContextByIndex(index).getPath();                                                                                                                                                                                      
				              var index1 = sPath1.match(/\d+/g);                                                                                                                                                                                                           
				              var lindex = parseInt(index1);                                                                                                                                                                                                               
				              var valores = aData.splice(parseInt(index1[0], 10), 1);                                                                                                                                                                                      
				              var oContext = oTable.getContextByIndex(index); // get context                                                                                                                                                                               
								//var loevm = oContext.getModel().setProperty(oContext.sPath + "/Loevm","X");                                                                                                                                                                          
								oContext.getModel().setProperty("/receitaLista/" + lindex + "/Loevm","X");                                                                                                                                                                             
								//var selectedData = oContext.getModel().getProperty("/receitaLista/" + index);                                                                                                                                                                        
								//Sequeira&nbsp;&nbsp;                                                                                                                                                                                                                                 
								valores[0].Loevm = "X";		                                                                                                                                                                                                                              
					             arr.push(valores[0]);                                                                                                                                                                                                                        
					            //Sequeira&nbsp;&nbsp;&nbsp;                                                                                                                                                                                                                  
			            });                                                                                                                                                                                                                                             
			            console.log(arr);                                                                                                                                                                                                                               
			            //oModel.setData(aData);                                                                                                                                                                                                                        
			            oModel.refresh();                                                                                                                                                                                                                               
			            oTable.setSelectedIndex(-1);                                                                                                                                                                                                                    
						for (var y = 0; y < arr.length; y++) {                                                                                                                                                                                                                   
									var dados = {};                                                                                                                                                                                                                                       
									var total = 0;                                                                                                                                                                                                                                        
									dados.Werks = sap.ui.getCore().dadosMaster.Werks;                                                                                                                                                                                                     
									dados.Acnum = sap.ui.getCore().dadosMaster.Acnum;                                                                                                                                                                                                     
									dados.Extwg = sap.ui.getCore().dadosProcessoId;                                                                                                                                                                                                       
									dados.Matkl = sap.ui.getCore().dadosDetail.Matkl;                                                                                                                                                                                                     
									//dados.TplnrFl = that.terrenos[x].Talhao;                                                                                                                                                                                                            
									dados.TplnrFl = arr[y].TplnrFl;                                                                                                                                                                                                                       
									//dados.Data = that.terrenos[x].Data;                                                                                                                                                                                                                 
									dados.Data = terrenos[0].Data;                                                                                                                                                                                                                        
									dados.Rcnum = receita.getSelectedKey();                                                                                                                                                                                                               
									dados.MatnrIns = arr[y].MatnrIns;                                                                                                                                                                                                                     
									dados.Rcdos = arr[y].Rcdos;                                                                                                                                                                                                                           
									dados.Lgort = arr[y].Lgort;                                                                                                                                                                                                                           
									dados.Loevm = arr[y].Loevm;                                                                                                                                                                                                                           
									oModel1.create("/SetReceitasSet", dados);                                                                                                                                                                                                             
						}                                                                                                                                                                                                                                                        
			          }                                                                                                                                                                                                                                                 
			        }                                                                                                                                                                                                                                                   
			        MessageBox.confirm("Do you want to delete selected records ?", {                                                                                                                                                                                    
			          title: "Confirm",                                                                                                                                                                                                                                 
			          onClose: fnDeleteRecord,                                                                                                                                                                                                                          
			          textDirection: sap.ui.core.TextDirection.Inherit                                                                                                                                                                                                  
			        });                                                                                                                                                                                                                                                 
			      }                                                                                                                                                                                                                                                     
			    },                                                                                                                                                                                                                                                      
		isDuplicateRecord: function (sTalhao) {                                                                                                                                                                                                                      
			var oTable2 = this.oView.byId("table2");                                                                                                                                                                                                                    
			var aData = oTable2.getModel().getProperty("/table2");                                                                                                                                                                                                      
			var isDuplicate = aData.some(function (item) {                                                                                                                                                                                                              
				return item.Talhao === sTalhao; // if duplicate terrain found then return true                                                                                                                                                                             
			});                                                                                                                                                                                                                                                         
			return isDuplicate;                                                                                                                                                                                                                                         
		},                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
		openReceitas: function (oEvent) {                                                                                                                                                                                                                            
			if (this.oView.byId("table2").getSelectedIndex() === -1) {                                                                                                                                                                                                  
				MessageToast.show("Selecionar terreno", {                                                                                                                                                                                                                  
					my: "center center", // default                                                                                                                                                                                                                           
					at: "center center" // default                                                                                                                                                                                                                            
				});                                                                                                                                                                                                                                                        
			} else {                                                                                                                                                                                                                                                    
				var that = this;                                                                                                                                                                                                                                           
				var oFilters = [];                                                                                                                                                                                                                                         
				oFilters.push(new sap.ui.model.Filter("Werks", "EQ", sap.ui.getCore().dadosMaster.Werks));                                                                                                                                                                 
				oFilters.push(new sap.ui.model.Filter("Matkl", "EQ", sap.ui.getCore().dadosDetail.Matkl));                                                                                                                                                                 
				oFilters.push(new sap.ui.model.Filter("Matnr", "EQ", sap.ui.getCore().dadosDetail.Matnr));                                                                                                                                                                 
				oFilters.push(new sap.ui.model.Filter("Acnum", "EQ", sap.ui.getCore().dadosMaster.Acnum));                                                                                                                                                                 
				var oTable2 = this.oView.byId("table2");                                                                                                                                                                                                                   
				var aIndex = oTable2.getSelectedIndices();	                                                                                                                                                                                                                
				var aAufnr = [];                                                                                                                                                                                                                                           
				var aSelectedTerrains = [];                                                                                                                                                                                                                                
				aIndex.forEach(function (index, i) {                                                                                                                                                                                                                       
					var oContext = oTable2.getContextByIndex(aIndex[i]); // get context                                                                                                                                                                                       
					var sTalhao = oContext.getProperty("Talhao"); // get terrain                                                                                                                                                                                              
					var sAufnr = oContext.getProperty("Aufnr");                                                                                                                                                                                                               
						that._gm.setProperty("/visible", true);                                                                                                                                                                                                                  
					aAufnr.push(sAufnr);                                                                                                                                                                                                                                      
					/*	if (sAufnr !== "") {                                                                                                                                                                                                                                   
							that._gm.setProperty("/visible", false);                                                                                                                                                                                                                
							return;                                                                                                                                                                                                                                                 
						} else {                                                                                                                                                                                                                                                 
							that._gm.setProperty("/visible", true);                                                                                                                                                                                                                 
						}*/                                                                                                                                                                                                                                                      
					aSelectedTerrains.push(sTalhao);                                                                                                                                                                                                                          
					//var sDate = oContext.getProperty("Data");                                                                                                                                                                                                               
					oFilters.push(new sap.ui.model.Filter("TplnrFl", "EQ", sTalhao));                                                                                                                                                                                         
				});                                                                                                                                                                                                                                                        
				aAufnr.forEach(function (item) {                                                                                                                                                                                                                           
					if (item) {                                                                                                                                                                                                                                               
						that._gm.setProperty("/visible", false);                                                                                                                                                                                                                 
					    return;                                                                                                                                                                                                                                               
					}&nbsp;                                                                                                                                                                                                                                                   
				});                                                                                                                                                                                                                                                        
				this.oModel.read("/GetReceitasSet", {                                                                                                                                                                                                                      
					filters: oFilters,                                                                                                                                                                                                                                        
					success: function (oData) {                                                                                                                                                                                                                               
						//					                                                                                                                                                                                                                                                  
						var json = new JSONModel();                                                                                                                                                                                                                              
						json.setData(oData);                                                                                                                                                                                                                                     
						that.oView.setModel(json, "receitas");                                                                                                                                                                                                                   
                                                                                                                                                                                                                                                               
						//	oFilters.push(new sap.ui.model.Filter("Acnum", "EQ", sap.ui.getCore().dadosMaster.Acnum));                                                                                                                                                            
						//	var tab = that.oView.byId("table2").getModel().getData().table2;                                                                                                                                                                                      
                                                                                                                                                                                                                                                               
						/*	for (var x = 0; x < tab.length; x++) {                                                                                                                                                                                                                
								oFilters.push(new sap.ui.model.Filter("TplnrFl", "EQ", tab[x].TplnrFl));                                                                                                                                                                               
							}*/                                                                                                                                                                                                                                                     
						var then = that;                                                                                                                                                                                                                                         
						that.oModel.read("/GetVolumeCaldaSet", {                                                                                                                                                                                                                 
							filters: oFilters,                                                                                                                                                                                                                                      
							success: function (oData2) {                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                               
								sap.ui.getCore().volumeCalda = oData2.results;                                                                                                                                                                                                         
                                                                                                                                                                                                                                                               
								//							then.calcTotalPrevisto();                                                                                                                                                                                                                     
                                                                                                                                                                                                                                                               
							},                                                                                                                                                                                                                                                      
							error: function (oError) {                                                                                                                                                                                                                              
                                                                                                                                                                                                                                                               
							}                                                                                                                                                                                                                                                       
						});                                                                                                                                                                                                                                                      
                                                                                                                                                                                                                                                               
					},                                                                                                                                                                                                                                                        
					error: function (oError) {                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                               
					}                                                                                                                                                                                                                                                         
				});                                                                                                                                                                                                                                                        
                                                                                                                                                                                                                                                               
				this._getDialog().open();                                                                                                                                                                                                                                  
			}                                                                                                                                                                                                                                                           
		},                                                                                                                                                                                                                                                           
		_getDialog: function () {                                                                                                                                                                                                                                    
			if (!this._oDialog) {                                                                                                                                                                                                                                       
				this._oDialog = sap.ui.xmlfragment(this.createId("idFrag"), "com.vistex.zagriplan.view.Receitas", this.getView().getController());                                                                                                                         
				this.getView().addDependent(this._oDialog);                                                                                                                                                                                                                
			}                                                                                                                                                                                                                                                           
			return this._oDialog;                                                                                                                                                                                                                                       
		},                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
		changeDosagem: function (oEvent) {                                                                                                                                                                                                                           
			var receita = this.byId(sap.ui.core.Fragment.createId("idFrag", "idReceita"));                                                                                                                                                                              
			var total = 0;                                                                                                                                                                                                                                              
			//var path = oEvent.getSource().getBindingContext().sPath;                                                                                                                                                                                                  
                                                                                                                                                                                                                                                               
			// Selecionar dados de receita&nbsp;                                                                                                                                                                                                                        
			for (var z = 0; z < this.oView.getModel("receitas").getData().results.length; z++) {                                                                                                                                                                        
				if (this.oView.getModel("receitas").getData().results[z].Rcnum === receita.getSelectedKey()) {                                                                                                                                                             
					var receitaLine = this.oView.getModel("receitas").getData().results[z];                                                                                                                                                                                   
					break;                                                                                                                                                                                                                                                    
				}                                                                                                                                                                                                                                                          
			}                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
			for (var x = 0; x < sap.ui.getCore().volumeCalda.length; x++) {                                                                                                                                                                                             
				// calcular total de dosagem por terreno                                                                                                                                                                                                                   
				switch (receitaLine.Ausme) {                                                                                                                                                                                                                               
				case 'VC': // Volume de calda                                                                                                                                                                                                                              
					total += parseFloat(sap.ui.getCore().volumeCalda[x].Acqtb);                                                                                                                                                                                               
					break;                                                                                                                                                                                                                                                    
				case 'HC': // Hectare                                                                                                                                                                                                                                      
					total += parseFloat(sap.ui.getCore().volumeCalda[x].Acarx);                                                                                                                                                                                               
					break;                                                                                                                                                                                                                                                    
				default:                                                                                                                                                                                                                                                   
				}                                                                                                                                                                                                                                                          
			}                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
			var doseTotal = total * parseFloat(oEvent.getSource().getValue());                                                                                                                                                                                          
			var dose = doseTotal.toFixed(2);                                                                                                                                                                                                                            
			var sPath = oEvent.getSource().getBinding("value").getContext().getPath();                                                                                                                                                                                  
			var receitaM = sap.ui.getCore().getModel("receitaLista");                                                                                                                                                                                                   
			receitaM.setProperty(sPath + "/TotalPrev",dose);                                                                                                                                                                                                            
			receitaM.refresh();                                                                                                                                                                                                                                         
			/*//var oTabReceita = this.                                                                                                                                                                                                                                 
			var prodRecEditM = sap.ui.getCore().getModel("receitaLista");                                                                                                                                                                                               
			prodRecEditM.setProperty("TotalPrev", dose);                                                                                                                                                                                                                
                                                                                                                                                                                                                                                               
			//ProdutoEditDid.setProperty("")                                                                                                                                                                                                                            
			prodRecEditM.refresh();                                                                                                                                                                                                                                     
*/                                                                                                                                                                                                                                                             
		},                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
		calcTotalPrevisto: function () {                                                                                                                                                                                                                             
			var receita = this.byId(sap.ui.core.Fragment.createId("idFrag", "idReceita"));                                                                                                                                                                              
			// Selecionar dados de receita&nbsp;                                                                                                                                                                                                                        
			for (var z = 0; z < this.oView.getModel("receitas").getData().results.length; z++) {                                                                                                                                                                        
				if (this.oView.getModel("receitas").getData().results[z].Rcnum === receita.getSelectedKey()) {                                                                                                                                                             
					var receitaLine = this.oView.getModel("receitas").getData().results[z];                                                                                                                                                                                   
					break;                                                                                                                                                                                                                                                    
				}                                                                                                                                                                                                                                                          
			}                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
			var tab = this.byId(sap.ui.core.Fragment.createId("idFrag", "idTabProd")).getModel();                                                                                                                                                                       
			var total = 0;                                                                                                                                                                                                                                              
                                                                                                                                                                                                                                                               
			for (var x = 0; x < sap.ui.getCore().volumeCalda.length; x++) {                                                                                                                                                                                             
                                                                                                                                                                                                                                                               
				// calcular total de dosagem por terreno                                                                                                                                                                                                                   
				switch (receitaLine.Ausme) {                                                                                                                                                                                                                               
				case 'VC': // Volume de calda                                                                                                                                                                                                                              
					total += parseFloat(sap.ui.getCore().volumeCalda[x].Acqtb);                                                                                                                                                                                               
					break;                                                                                                                                                                                                                                                    
				case 'HC': // Hectare                                                                                                                                                                                                                                      
					total += parseFloat(sap.ui.getCore().volumeCalda[x].Acarx);                                                                                                                                                                                               
					break;                                                                                                                                                                                                                                                    
				default:                                                                                                                                                                                                                                                   
				}                                                                                                                                                                                                                                                          
			}                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
			for (var y = 0; y < tab.getData().receitaLista.length; y++) {                                                                                                                                                                                               
				var doseTotal = total * parseFloat(tab.getData().receitaLista[y].Rcdos);                                                                                                                                                                                   
				var dose = doseTotal.toFixed(2);                                                                                                                                                                                                                           
				tab.setProperty('/receitaLista/' + y + '/' + 'TotalPrev', dose);                                                                                                                                                                                           
				tab.refresh();                                                                                                                                                                                                                                             
			}                                                                                                                                                                                                                                                           
		},                                                                                                                                                                                                                                                           
		onCloseDialog: function (oEvent) {                                                                                                                                                                                                                           
			if (oEvent.getSource().getText() === "Ok") {                                                                                                                                                                                                                
                                                                                                                                                                                                                                                               
			} else {                                                                                                                                                                                                                                                    
				//				oEvent.getSource().                                                                                                                                                                                                                                  
				this.byId(sap.ui.core.Fragment.createId("idFrag", "helloDialog")).close();                                                                                                                                                                                 
				//				this.byId(sap.ui.core.Fragment.createId("idFrag","helloDialog")).destroyContent();                                                                                                                                                                   
				this.oView.byId("table2").setSelectedIndex(-1); // get the selected index                                                                                                                                                                                  
			}                                                                                                                                                                                                                                                           
			this.setTable2Data();                                                                                                                                                                                                                                       
		},                                                                                                                                                                                                                                                           
		onAfterClose: function (oEvent) {                                                                                                                                                                                                                            
			if (this._oDialog) {                                                                                                                                                                                                                                        
				this._oDialog.destroy();                                                                                                                                                                                                                                   
				this._oDialog = null; // make it falsy so that it can be created next time                                                                                                                                                                                 
			}                                                                                                                                                                                                                                                           
		},                                                                                                                                                                                                                                                           
		onTechTaskorder: function (oEvent) {                                                                                                                                                                                                                         
			var that = this;                                                                                                                                                                                                                                            
			var deferred = jQuery.Deferred();                                                                                                                                                                                                                           
			var selectedTerrains = [];                                                                                                                                                                                                                                  
			var sTalhao;                                                                                                                                                                                                                                                
			var sData;                                                                                                                                                                                                                                                  
			var sAarea;                                                                                                                                                                                                                                                 
			var sAufnr;                                                                                                                                                                                                                                                 
			var sRcnum;                                                                                                                                                                                                                                                 
			var oTable2 = this.oView.byId("table2");                                                                                                                                                                                                                    
			var aIndex = oTable2.getSelectedIndices();                                                                                                                                                                                                                  
			aIndex.forEach(function (index, i) {                                                                                                                                                                                                                        
				var oContext = oTable2.getContextByIndex(aIndex[i]); // get context                                                                                                                                                                                        
				sTalhao = oContext.getProperty("Talhao"); // get terrain                                                                                                                                                                                                   
				sData = oContext.getProperty("Data");                                                                                                                                                                                                                      
				sAarea = oContext.getProperty("Aarea");                                                                                                                                                                                                                    
				sAufnr = oContext.getProperty("Aufnr");                                                                                                                                                                                                                    
				sRcnum = oContext.getProperty("Rcnum");                                                                                                                                                                                                                    
			});                                                                                                                                                                                                                                                         
			var oFilters = [];                                                                                                                                                                                                                                          
			oFilters.push(new sap.ui.model.Filter("Acnum", "EQ", sap.ui.getCore().dadosMaster.Acnum));                                                                                                                                                                  
			oFilters.push(new sap.ui.model.Filter("Extwg", "EQ", sap.ui.getCore().dadosProcessoId));                                                                                                                                                                    
			oFilters.push(new sap.ui.model.Filter("Matkl", "EQ", sap.ui.getCore().dadosDetail.Matkl));                                                                                                                                                                  
			oFilters.push(new sap.ui.model.Filter("Data", "EQ", sap.ui.getCore().Data));                                                                                                                                                                                
			oFilters.push(new sap.ui.model.Filter("TplnrFl", "EQ", sTalhao));                                                                                                                                                                                           
			oFilters.push(new sap.ui.model.Filter("Data", "EQ", sData));                                                                                                                                                                                                
			oFilters.push(new sap.ui.model.Filter("Aarea", "EQ", sAarea));                                                                                                                                                                                              
			oFilters.push(new sap.ui.model.Filter("Aufnr", "EQ", sAufnr));                                                                                                                                                                                              
			oFilters.push(new sap.ui.model.Filter("Rcnum", "EQ", sRcnum));                                                                                                                                                                                              
                                                                                                                                                                                                                                                               
			this.oModel.read("/SetTechCompleteSet", {                                                                                                                                                                                                                   
				filters: oFilters,                                                                                                                                                                                                                                         
				success: function (oData) {                                                                                                                                                                                                                                
					var resDataStatus = oData.results[0].Status;                                                                                                                                                                                                              
					var tableM = that.oView.byId("table2").getModel().getData().table2;                                                                                                                                                                                       
					tableM.forEach(function (item) {                                                                                                                                                                                                                          
						if ((oData.results[0].TplnrFl === item.Talhao) && (resDataStatus === "X")) {                                                                                                                                                                             
							item.Status = "X";                                                                                                                                                                                                                                      
						}                                                                                                                                                                                                                                                        
					});                                                                                                                                                                                                                                                       
                                                                                                                                                                                                                                                               
					var resMsg = oData.results[0].Descr;                                                                                                                                                                                                                      
					var msgTitle = that.getText("infoTitle");                                                                                                                                                                                                                 
					MessageBox.show(resMsg, {                                                                                                                                                                                                                                 
						title: msgTitle,                                                                                                                                                                                                                                         
						icon: MessageBox.Icon.INFORMATION                                                                                                                                                                                                                        
					});                                                                                                                                                                                                                                                       
					that.oView.byId("table2").getModel().refresh();                                                                                                                                                                                                           
				}                                                                                                                                                                                                                                                          
			});                                                                                                                                                                                                                                                         
                                                                                                                                                                                                                                                               
			/*	var oModel = models.callBackEnd();                                                                                                                                                                                                                       
				var oTable2 = this.oView.byId("table2");                                                                                                                                                                                                                   
					var aIndex = oTable2.getSelectedIndices();                                                                                                                                                                                                                
					aIndex.forEach(function (index, i) {                                                                                                                                                                                                                      
						var oContext = oTable2.getContextByIndex(aIndex[i]); // get context                                                                                                                                                                                      
						var sTalhao = oContext.getProperty("Talhao"); // get terrain                                                                                                                                                                                             
						var sData = oContext.getProperty("Data");                                                                                                                                                                                                                
						var sCmnum = oContext.getProperty("Cmnum");                                                                                                                                                                                                              
						var sA                                                                                                                                                                                                                                                   
					for (var x = 0; x < this.oView.byId("table2").getModel().getData().table2.length; x++) {                                                                                                                                                                  
                                                                                                                                                                                                                                                               
						var line = {};                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
						line.Acnum = sap.ui.getCore().dadosMaster.Acnum;                                                                                                                                                                                                         
						line.Extwg = sap.ui.getCore().dadosProcessoId;                                                                                                                                                                                                           
						line.Matkl = sap.ui.getCore().dadosDetail.Matkl;                                                                                                                                                                                                         
						line.TplnrFl = this.oView.byId("table2").getModel().getData().table2[x].Talhao;                                                                                                                                                                          
						line.Data = this.oView.byId("table2").getModel().getData().table2[x].Data;                                                                                                                                                                               
						line.Aarea = this.oView.byId("table2").getModel().getData().table2[x].Aarea;                                                                                                                                                                             
						line.Cmnum = this.oView.byId("table2").getModel().getData().table2[x].Cmnum;                                                                                                                                                                             
						line.Loevm = this.oView.byId("table2").getModel().getData().table2[x].Loevm;                                                                                                                                                                             
						line.Aufnr = this.oView.byId("table2").getModel().getData().table2[x].Aufnr;                                                                                                                                                                             
						oModel.create("/SetTechCompleteSet", line);                                                                                                                                                                                                              
					}                                                                                                                                                                                                                                                         
			*/                                                                                                                                                                                                                                                          
                                                                                                                                                                                                                                                               
		},                                                                                                                                                                                                                                                           
		changeReceita: function (oEvent) {                                                                                                                                                                                                                           
			sap.ui.core.BusyIndicator.show(0);                                                                                                                                                                                                                          
			var that = this;                                                                                                                                                                                                                                            
			var oFilters = [];                                                                                                                                                                                                                                          
			var oFilters1 = [];                                                                                                                                                                                                                                         
			var oTabProd = this.byId(sap.ui.core.Fragment.createId("idFrag", "idTabProd"));                                                                                                                                                                             
			var oTabProdSi = this.byId(sap.ui.core.Fragment.createId("idFrag", "idTabProdSimilar"));                                                                                                                                                                    
                                                                                                                                                                                                                                                               
			//oTabProd.unbindRows();                                                                                                                                                                                                                                    
			//oTabProdSi.unbindRows();			                                                                                                                                                                                                                               
                                                                                                                                                                                                                                                               
			oFilters.push(new sap.ui.model.Filter("Rcnum", "EQ", oEvent.getParameter("selectedItem").getKey()));                                                                                                                                                        
			oFilters.push(new sap.ui.model.Filter("Werks", "EQ", sap.ui.getCore().dadosMaster.Werks));                                                                                                                                                                  
			oFilters.push(new sap.ui.model.Filter("Acnum", "EQ", sap.ui.getCore().dadosMaster.Acnum));                                                                                                                                                                  
			oFilters.push(new sap.ui.model.Filter("Matkl", "EQ", sap.ui.getCore().dadosDetail.Matkl));                                                                                                                                                                  
			oFilters.push(new sap.ui.model.Filter("Data", "EQ", sap.ui.getCore().Data));                                                                                                                                                                                
			var oTable2 = this.oView.byId("table2");                                                                                                                                                                                                                    
			var aIndex = oTable2.getSelectedIndices();                                                                                                                                                                                                                  
			aIndex.forEach(function (index, i) {                                                                                                                                                                                                                        
				var oContext = oTable2.getContextByIndex(aIndex[i]); // get context                                                                                                                                                                                        
				var sTalhao = oContext.getProperty("Talhao"); // get terrain                                                                                                                                                                                               
				//selectedTerrains.push(sTalhao);                                                                                                                                                                                                                          
				//var sDate = oContext.getProperty("Data");                                                                                                                                                                                                                
				oFilters.push(new sap.ui.model.Filter("TplnrFl", "EQ", sTalhao));                                                                                                                                                                                          
			});                                                                                                                                                                                                                                                         
                                                                                                                                                                                                                                                               
			sap.ui.getCore().Rcnum = oEvent.getParameter("selectedItem").getKey();                                                                                                                                                                                      
                                                                                                                                                                                                                                                               
			this.oModel.read("/GetReceitaListaSet", {                                                                                                                                                                                                                   
				filters: oFilters,                                                                                                                                                                                                                                         
				success: function (oData) {                                                                                                                                                                                                                                
					var then = that;                                                                                                                                                                                                                                          
					var json = new JSONModel();                                                                                                                                                                                                                               
					sap.ui.getCore().setModel(json, "receitaLista");                                                                                                                                                                                                          
					var receitaModel = sap.ui.getCore().getModel("receitaLista");                                                                                                                                                                                             
					receitaModel.setProperty("/", oData.results);                                                                                                                                                                                                             
                                                                                                                                                                                                                                                               
					json.setData({                                                                                                                                                                                                                                            
						receitaLista: oData.results                                                                                                                                                                                                                              
					});                                                                                                                                                                                                                                                       
					var tab = that.byId(sap.ui.core.Fragment.createId("idFrag", "idTabProd"));                                                                                                                                                                                
					tab.setVisibleRowCount(oData.results.length);                                                                                                                                                                                                             
					tab.setModel(json);                                                                                                                                                                                                                                       
					tab.bindRows("/receitaLista");                                                                                                                                                                                                                            
					that.calcTotalPrevisto();                                                                                                                                                                                                                                 
                                                                                                                                                                                                                                                               
					that.oModel.read("/GetReceitaListaSimilarSet", {                                                                                                                                                                                                          
						filters: oFilters,                                                                                                                                                                                                                                       
						success: function (oData1) {                                                                                                                                                                                                                             
							var json1 = new JSONModel();                                                                                                                                                                                                                            
							sap.ui.getCore().setModel(json1, "receitaSimilar");                                                                                                                                                                                                     
							var receitaSimModel = sap.ui.getCore().getModel("receitaSimilar");                                                                                                                                                                                      
							receitaSimModel.setProperty("/", oData.results);                                                                                                                                                                                                        
							json1.setData({                                                                                                                                                                                                                                         
								receitaSimilar: oData1.results                                                                                                                                                                                                                         
							});                                                                                                                                                                                                                                                     
							var tabSimilar = that.byId(sap.ui.core.Fragment.createId("idFrag", "idTabProdSimilar"));                                                                                                                                                                
							tabSimilar.setVisibleRowCount(oData1.results.length);                                                                                                                                                                                                   
							tabSimilar.setModel(json1);                                                                                                                                                                                                                             
							tabSimilar.bindRows("/receitaSimilar");                                                                                                                                                                                                                 
							sap.ui.core.BusyIndicator.hide();                                                                                                                                                                                                                       
						},                                                                                                                                                                                                                                                       
						error: function (oError) {                                                                                                                                                                                                                               
                                                                                                                                                                                                                                                               
						}                                                                                                                                                                                                                                                        
					});                                                                                                                                                                                                                                                       
                                                                                                                                                                                                                                                               
				},                                                                                                                                                                                                                                                         
				error: function (oError) {                                                                                                                                                                                                                                 
                                                                                                                                                                                                                                                               
				}                                                                                                                                                                                                                                                          
			});                                                                                                                                                                                                                                                         
                                                                                                                                                                                                                                                               
		},                                                                                                                                                                                                                                                           
		/* ------------- ADD/EDIT/DELETE ---------------------- */                                                                                                                                                                                                   
		sPath1: null,                                                                                                                                                                                                                                                
		/**&nbsp;                                                                                                                                                                                                                                                    
		 * Sends data from selected table row to be added to details model.                                                                                                                                                                                          
		 * @param {object} oEvent - Object of the source control.&nbsp;                                                                                                                                                                                              
		 */                                                                                                                                                                                                                                                          
		onTableRowSelect1: function (oEvent) {                                                                                                                                                                                                                       
			if (!oEvent || oEvent.getSource().getSelectedIndex() === -1) {                                                                                                                                                                                              
				return;                                                                                                                                                                                                                                                    
			}                                                                                                                                                                                                                                                           
			this.sPath1 = oEvent.getSource().getContextByIndex(oEvent.getSource().getSelectedIndex()).getPath();                                                                                                                                                        
			this.setDialogValues();                                                                                                                                                                                                                                     
		},                                                                                                                                                                                                                                                           
		setDialogValues: function () {                                                                                                                                                                                                                               
			var newModel = new sap.ui.model.json.JSONModel();                                                                                                                                                                                                           
			sap.ui.getCore().setModel(newModel, "recProdDetails");                                                                                                                                                                                                      
			var data = sap.ui.getCore().getModel("receitaLista").getProperty(this.sPath1);                                                                                                                                                                              
			sap.ui.getCore().getModel("recProdDetails").setData(JSON.parse(JSON.stringify(data)));                                                                                                                                                                      
			var oFilters1 = [];                                                                                                                                                                                                                                         
			var oInsumosTable = this.byId(sap.ui.core.Fragment.createId("idFrag", "idTabProd"));                                                                                                                                                                        
			var aIndex = oInsumosTable.getSelectedIndices();                                                                                                                                                                                                            
			aIndex.forEach(function (index, i) {                                                                                                                                                                                                                        
				var oContext = oInsumosTable.getContextByIndex(aIndex[i]); // get context                                                                                                                                                                                  
				var sMatnrIns = oContext.getModel().getProperty("/receitaLista/" + aIndex[i] + "/MatnrIns");                                                                                                                                                               
				oFilters1.push(new sap.ui.model.Filter("MatnrIns", "EQ", sMatnrIns));                                                                                                                                                                                      
			});                                                                                                                                                                                                                                                         
			oFilters1.push(new sap.ui.model.Filter("Werks", "EQ", sap.ui.getCore().dadosMaster.Werks));	                                                                                                                                                                
			var that = this;                                                                                                                                                                                                                                            
			that.oModel.read("/GetStorageLocationSet", {                                                                                                                                                                                                                
				filters: oFilters1,                                                                                                                                                                                                                                        
				success: function (oData2) {                                                                                                                                                                                                                               
					var json2 = new JSONModel();                                                                                                                                                                                                                              
					sap.ui.getCore().setModel(json2, "storageLocF4");                                                                                                                                                                                                         
					var oModel = sap.ui.getCore().getModel("storageLocF4");                                                                                                                                                                                                   
					oModel.setProperty("/", oData2.results);                                                                                                                                                                                                                  
				}                                                                                                                                                                                                                                                          
			});                                                                                                                                                                                                                                                         
		},                                                                                                                                                                                                                                                           
			onDeleteReceita: function (oEvent) {                                                                                                                                                                                                                        
          	var oModel1 = new ODataModel("/sap/opu/odata/sap/ZFARM_AGRIPLAN_SRV/");                                                                                                                                                                             
			var oTab = this.byId(sap.ui.core.Fragment.createId("idFrag", "idTabProd"));                                                                                                                                                                                 
		/*	var selLine = oTab.getSelectedIndex();                                                                                                                                                                                                                    
			var line = oTab.getModel().getData().receitaLista[selLine];                                                                                                                                                                                                 
			if (selLine >= 0) {                                                                                                                                                                                                                                         
				//				if (line.NewData !== undefined && line.NewData === "X") {                                                                                                                                                                                            
				oTab.getModel().getData().receitaLista.splice(selLine, 1);                                                                                                                                                                                                 
				oTab.setVisibleRowCount(oTab.getModel().getData().receitaLista.length);                                                                                                                                                                                    
	     	oTab.getModel().refresh();*/                                                                                                                                                                                                                            
				var insumos = oTab.getModel().getData().receitaLista;                                                                                                                                                                                                      
			    var terrenos = this.oView.byId("table2").getModel().getData().table2;                                                                                                                                                                                   
			    var receita = this.byId(sap.ui.core.Fragment.createId("idFrag", "idReceita"));                                                                                                                                                                          
				MessageToast.show("Insumo removido da receita", {                                                                                                                                                                                                          
					my: "center center", // default                                                                                                                                                                                                                           
					at: "center center", // default                                                                                                                                                                                                                           
				});                                                                                                                                                                                                                                                        
		   var tab = this.byId(sap.ui.core.Fragment.createId("idFrag", "idTabProd"));                                                                                                                                                                                
			var oModel = tab.getModel().getData();                                                                                                                                                                                                                      
			var newModel = new sap.ui.model.json.JSONModel();                                                                                                                                                                                                           
			sap.ui.getCore().setModel(newModel, "deleteProd");                                                                                                                                                                                                          
			sap.ui.getCore().getModel("deleteProd").setData(JSON.parse(JSON.stringify(oModel)));                                                                                                                                                                        
			var indexs = this.sPath1.split("/");                                                                                                                                                                                                                        
			var index = indexs[indexs.length - 1];                                                                                                                                                                                                                      
			oModel.receitaLista.splice(index, 1);                                                                                                                                                                                                                       
			var deleteModel = sap.ui.getCore().getModel("deleteProd");                                                                                                                                                                                                  
			deleteModel.setProperty(this.sPath1 + "/Loevm", "X");                                                                                                                                                                                                       
		    console.log(deleteModel);                                                                                                                                                                                                                                
			tab.getModel().refresh();                                                                                                                                                                                                                                   
			tab.setSelectedIndex(-1);                                                                                                                                                                                                                                   
			oTab.setVisibleRowCount(oTab.getModel().getData().receitaLista.length);                                                                                                                                                                                     
		                                                                                                                                                                                                                                                             
                                                                                                                                                                                                                                                               
				// } else {                                                                                                                                                                                                                                                
				// 	MessageToast.show("Insumo no pode ser removido", {                                                                                                                                                                                                    
				// 		my: "center center", // default                                                                                                                                                                                                                       
				// 		at: "center center", // default                                                                                                                                                                                                                       
				// 	});                                                                                                                                                                                                                                                    
				// }                                                                                                                                                                                                                                                       
			//}                                                                                                                                                                                                                                                         
			   var len = deleteModel.getData().receitaLista;                                                                                                                                                                                                            
				for (var y = 0; y < len.length; y++) {                                                                                                                                                                                                                     
							var dados = {};                                                                                                                                                                                                                                         
							var total = 0;                                                                                                                                                                                                                                          
							dados.Werks = sap.ui.getCore().dadosMaster.Werks;                                                                                                                                                                                                       
							dados.Acnum = sap.ui.getCore().dadosMaster.Acnum;                                                                                                                                                                                                       
							dados.Extwg = sap.ui.getCore().dadosProcessoId;                                                                                                                                                                                                         
							dados.Matkl = sap.ui.getCore().dadosDetail.Matkl;                                                                                                                                                                                                       
							//dados.TplnrFl = that.terrenos[x].Talhao;                                                                                                                                                                                                              
							dados.TplnrFl = len[y].TplnrFl;                                                                                                                                                                                                                         
							//dados.Data = that.terrenos[x].Data;                                                                                                                                                                                                                   
							dados.Data = terrenos[0].Data;                                                                                                                                                                                                                          
							dados.Rcnum = receita.getSelectedKey();                                                                                                                                                                                                                 
							dados.MatnrIns = len[y].MatnrIns;                                                                                                                                                                                                                       
							dados.Rcdos = len[y].Rcdos;                                                                                                                                                                                                                             
							dados.Lgort = len[y].Lgort;                                                                                                                                                                                                                             
							dados.Loevm = len[y].Loevm;                                                                                                                                                                                                                             
							oModel1.create("/SetReceitasSet", dados);                                                                                                                                                                                                               
				}                                                                                                                                                                                                                                                          
                                                                                                                                                                                                                                                               
                                                                                                                                                                                                                                                               
		},                                                                                                                                                                                                                                                           
		/* ------------- ADD/EDIT/DELETE ---------------------- */                                                                                                                                                                                                   
		sPath2: null,                                                                                                                                                                                                                                                
		/**&nbsp;                                                                                                                                                                                                                                                    
		 * Sends data from selected table row to be added to details model.                                                                                                                                                                                          
		 * @param {object} oEvent - Object of the source control.&nbsp;                                                                                                                                                                                              
		 */                                                                                                                                                                                                                                                          
		onTableRowSelect2: function (oEvent) {                                                                                                                                                                                                                       
			if (!oEvent || oEvent.getSource().getSelectedIndex() === -1) {                                                                                                                                                                                              
				return;                                                                                                                                                                                                                                                    
			}                                                                                                                                                                                                                                                           
			this.sPath2 = oEvent.getSource().getContextByIndex(oEvent.getSource().getSelectedIndex()).getPath();                                                                                                                                                        
			this.setDialogValues2();                                                                                                                                                                                                                                    
		},                                                                                                                                                                                                                                                           
		setDialogValues2: function () {                                                                                                                                                                                                                              
			var newModel = new sap.ui.model.json.JSONModel();                                                                                                                                                                                                           
			sap.ui.getCore().setModel(newModel, "recProd2Details");                                                                                                                                                                                                     
			var data = sap.ui.getCore().getModel("receitaSimilar").getProperty(this.sPath2);                                                                                                                                                                            
			sap.ui.getCore().getModel("recProd2Details").setData(JSON.parse(JSON.stringify(data)));                                                                                                                                                                     
			var oFilters1 = [];                                                                                                                                                                                                                                         
			var that = this;                                                                                                                                                                                                                                            
			var sMatnrIns = sap.ui.getCore().getModel("receitaSimilar").getProperty(this.sPath2 + "/MatnrIns");                                                                                                                                                         
			oFilters1.push(new sap.ui.model.Filter("Werks", "EQ", sap.ui.getCore().dadosMaster.Werks));                                                                                                                                                                 
			oFilters1.push(new sap.ui.model.Filter("MatnrIns", "EQ", sMatnrIns));                                                                                                                                                                                       
                                                                                                                                                                                                                                                               
			that.oModel.read("/GetStorageLocationSet", {                                                                                                                                                                                                                
				filters: oFilters1,                                                                                                                                                                                                                                        
				success: function (oData2) {                                                                                                                                                                                                                               
					var json2 = new JSONModel();                                                                                                                                                                                                                              
					sap.ui.getCore().setModel(json2, "storageLocF4");                                                                                                                                                                                                         
					var oModel = sap.ui.getCore().getModel("storageLocF4");                                                                                                                                                                                                   
					oModel.setProperty("/", oData2.results);                                                                                                                                                                                                                  
				}                                                                                                                                                                                                                                                          
			});                                                                                                                                                                                                                                                         
		},                                                                                                                                                                                                                                                           
		/* Get Storage Location fragment */                                                                                                                                                                                                                          
		oDiaStorageLoc: null,                                                                                                                                                                                                                                        
		getInsumoStorageDia: function () {                                                                                                                                                                                                                           
			if (!this.oDiaStorageLoc) {                                                                                                                                                                                                                                 
				this.oDiaStorageLoc = sap.ui.xmlfragment(this.createId("idFrag"), "com.vistex.zagriplan.view.ProdReceipEdit", this.getView().getController());                                                                                                             
				//	this.getView().addDependent(this.oDiaSchedule);                                                                                                                                                                                                         
			}                                                                                                                                                                                                                                                           
			return this.oDiaStorageLoc;                                                                                                                                                                                                                                 
		},                                                                                                                                                                                                                                                           
		onStorageLocationIns : function(oEvent){                                                                                                                                                                                                                     
			 var oTable = this.byId(sap.ui.core.Fragment.createId("idFrag", "idTabProd"));                                                                                                                                                                              
			 var aSelIndex = oTable.getSelectedIndices();                                                                                                                                                                                                               
			 if (aSelIndex.length === 0) { // no selection                                                                                                                                                                                                              
			        MessageBox.show(new sap.m.Text({                                                                                                                                                                                                                    
			          text: "Selecione ao menos uma linha",                                                                                                                                                                                                             
			          textAlign: 'Center',                                                                                                                                                                                                                              
			          width: '100%'                                                                                                                                                                                                                                     
			        }), {                                                                                                                                                                                                                                               
			          title: "Information",                                                                                                                                                                                                                             
			          icon: MessageBox.Icon.INFORMATION,                                                                                                                                                                                                                
			         // styleClass: sCozy                                                                                                                                                                                                                               
			        });                                                                                                                                                                                                                                                 
			 } else {                                                                                                                                                                                                                                                   
				 this.getInsumoStorageDia().open();                                                                                                                                                                                                                        
			 }                                                                                                                                                                                                                                                          
		},                                                                                                                                                                                                                                                           
		/**&nbsp;                                                                                                                                                                                                                                                    
		 * Inserts a new or updates the table's selected record&nbsp;                                                                                                                                                                                                
		 * @param {object} oEvent - Object of the source control.&nbsp;                                                                                                                                                                                              
		 */                                                                                                                                                                                                                                                          
		onSaveStorageLocIns: function (oEvent) {                                                                                                                                                                                                                     
			var oInsumosTable = this.byId(sap.ui.core.Fragment.createId("idFrag", "idTabProd"));                                                                                                                                                                        
			var storageLoc = sap.ui.getCore().getModel("recProdDetails").getProperty("/Lgort");                                                                                                                                                                         
		    //var sDose = sap.ui.getCore().getModel("gm").getProperty("/detail3/doseInsumo");                                                                                                                                                                        
			 var receitaModel = sap.ui.getCore().getModel("receitaLista");                                                                                                                                                                                              
			var aIndex = oInsumosTable.getSelectedIndices();                                                                                                                                                                                                            
			aIndex.forEach(function (index, i) {                                                                                                                                                                                                                        
				//Sequeira                                                                                                                                                                                                                                                 
				  var oContext = oInsumosTable.getContextByIndex(aIndex[i]); // get context	                                                                                                                                                                               
	              var sPath1 = oInsumosTable.getContextByIndex(index).getPath();                                                                                                                                                                                  
	              var index1 = sPath1.match(/\d+/g);                                                                                                                                                                                                              
	              var lindex = parseInt(index1);				                                                                                                                                                                                                              
				//Sequeira                                                                                                                                                                                                                                                 
				oContext.getModel().setProperty("/receitaLista/" + lindex + "/Lgort",storageLoc);                                                                                                                                                                          
				//oContext.getModel().setProperty("/receitaLista/" + aIndex[i] + "/Rcdos",sDose);                                                                                                                                                                          
			});                                                                                                                                                                                                                                                         
			receitaModel.refresh();                                                                                                                                                                                                                                     
			oInsumosTable.setSelectedIndex(-1);                                                                                                                                                                                                                         
			this.onCloseDialog1(oEvent); // close dialog by btn id                                                                                                                                                                                                      
                                                                                                                                                                                                                                                               
		},                                                                                                                                                                                                                                                           
		/* Get Dose fragment */                                                                                                                                                                                                                                      
		oDiaDoseIns : null,                                                                                                                                                                                                                                          
		getDoseInsDia: function () {                                                                                                                                                                                                                                 
			if (!this.oDiaDoseIns) {                                                                                                                                                                                                                                    
				this.oDiaDoseIns = sap.ui.xmlfragment(this.createId("idFrag"), "com.vistex.zagriplan.view.DoseInsumo", this.getView().getController());                                                                                                                    
				//	this.getView().addDependent(this.oDiaSchedule);                                                                                                                                                                                                         
			}                                                                                                                                                                                                                                                           
			return this.oDiaDoseIns;                                                                                                                                                                                                                                    
		},                                                                                                                                                                                                                                                           
		onDoseIns : function(){                                                                                                                                                                                                                                      
			 var oTable = this.byId(sap.ui.core.Fragment.createId("idFrag", "idTabProd"));                                                                                                                                                                              
			 var aSelIndex = oTable.getSelectedIndices();                                                                                                                                                                                                               
			 if (aSelIndex.length === 0) { // no selection                                                                                                                                                                                                              
			        MessageBox.show(new sap.m.Text({                                                                                                                                                                                                                    
			          text: "Selecione ao menos uma linha",                                                                                                                                                                                                             
			          textAlign: 'Center',                                                                                                                                                                                                                              
			          width: '100%'                                                                                                                                                                                                                                     
			        }), {                                                                                                                                                                                                                                               
			          title: "Information",                                                                                                                                                                                                                             
			          icon: MessageBox.Icon.INFORMATION,                                                                                                                                                                                                                
			         // styleClass: sCozy                                                                                                                                                                                                                               
			        });                                                                                                                                                                                                                                                 
			 } else {                                                                                                                                                                                                                                                   
				 sap.ui.getCore().getModel("gm").setProperty("/detail3/doseInsumo","")                                                                                                                                                                                     
				 this.getDoseInsDia().open();                                                                                                                                                                                                                              
			 }                                                                                                                                                                                                                                                          
		},                                                                                                                                                                                                                                                           
		onSaveDoseIns : function(oEvent){                                                                                                                                                                                                                            
			var oInsumosTable = this.byId(sap.ui.core.Fragment.createId("idFrag", "idTabProd"));                                                                                                                                                                        
			var sDose = sap.ui.getCore().getModel("gm").getProperty("/detail3/doseInsumo");                                                                                                                                                                             
			 var receitaModel = sap.ui.getCore().getModel("receitaLista");                                                                                                                                                                                              
			var receita = this.byId(sap.ui.core.Fragment.createId("idFrag", "idReceita"));                                                                                                                                                                              
			var total = 0;                                                                                                                                                                                                                                              
			//var path = oEvent.getSource().getBindingContext().sPath;                                                                                                                                                                                                  
                                                                                                                                                                                                                                                               
			// Selecionar dados de receita&nbsp;                                                                                                                                                                                                                        
			for (var z = 0; z < this.oView.getModel("receitas").getData().results.length; z++) {                                                                                                                                                                        
				if (this.oView.getModel("receitas").getData().results[z].Rcnum === receita.getSelectedKey()) {                                                                                                                                                             
					var receitaLine = this.oView.getModel("receitas").getData().results[z];                                                                                                                                                                                   
					break;                                                                                                                                                                                                                                                    
				}                                                                                                                                                                                                                                                          
			}                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
			for (var x = 0; x < sap.ui.getCore().volumeCalda.length; x++) {                                                                                                                                                                                             
				// calcular total de dosagem por terreno                                                                                                                                                                                                                   
				switch (receitaLine.Ausme) {                                                                                                                                                                                                                               
				case 'VC': // Volume de calda                                                                                                                                                                                                                              
					total += parseFloat(sap.ui.getCore().volumeCalda[x].Acqtb);                                                                                                                                                                                               
					break;                                                                                                                                                                                                                                                    
				case 'HC': // Hectare                                                                                                                                                                                                                                      
					total += parseFloat(sap.ui.getCore().volumeCalda[x].Acarx);                                                                                                                                                                                               
					break;                                                                                                                                                                                                                                                    
				default:                                                                                                                                                                                                                                                   
				}                                                                                                                                                                                                                                                          
			}                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
			var doseTotal = total * parseFloat(sDose);                                                                                                                                                                                                                  
			var totalPrev = doseTotal.toFixed(2);                                                                                                                                                                                                                       
			var aIndex = oInsumosTable.getSelectedIndices();                                                                                                                                                                                                            
			aIndex.forEach(function (index, i) {                                                                                                                                                                                                                        
				//Sequeira                                                                                                                                                                                                                                                 
				var oContext = oInsumosTable.getContextByIndex(aIndex[i]); // get context                                                                                                                                                                                  
	            var sPath1 = oInsumosTable.getContextByIndex(index).getPath();                                                                                                                                                                                    
	            var index1 = sPath1.match(/\d+/g);                                                                                                                                                                                                                
	            var lindex = parseInt(index1);									                                                                                                                                                                                                           
				oContext.getModel().setProperty("/receitaLista/" + lindex + "/Rcdos",sDose);                                                                                                                                                                               
				oContext.getModel().setProperty("/receitaLista/" + lindex + "/TotalPrev",totalPrev)                                                                                                                                                                        
				//Sequeira                                                                                                                                                                                                                                                 
			});                                                                                                                                                                                                                                                         
			receitaModel.refresh();                                                                                                                                                                                                                                     
			oInsumosTable.setSelectedIndex(-1);                                                                                                                                                                                                                         
			this.onCloseDialog1(oEvent); // close dialog by btn id                                                                                                                                                                                                      
		},                                                                                                                                                                                                                                                           
		 oDiaStoragLocInsSim: null,                                                                                                                                                                                                                                  
		getInsumoSimStorDia: function () {                                                                                                                                                                                                                           
			if (!this.oDiaStoragLocInsSim) {                                                                                                                                                                                                                            
				this.oDiaStoragLocInsSim = sap.ui.xmlfragment(this.createId("idFrag"), "com.vistex.zagriplan.view.ProdReceipEdit2", this.getView().getController());                                                                                                       
				//	this.getView().addDependent(this.oDiaSchedule);                                                                                                                                                                                                         
			}                                                                                                                                                                                                                                                           
			return this.oDiaStoragLocInsSim;                                                                                                                                                                                                                            
		},                                                                                                                                                                                                                                                           
		onStorageLocInsSim : function(oEvent){                                                                                                                                                                                                                       
			 var oTable = this.byId(sap.ui.core.Fragment.createId("idFrag", "idTabProdSimilar"));                                                                                                                                                                       
			 var aSelIndex = oTable.getSelectedIndices();                                                                                                                                                                                                               
			 if (aSelIndex.length === 0) { // no selection                                                                                                                                                                                                              
			        MessageBox.show(new sap.m.Text({                                                                                                                                                                                                                    
			          text: "Selecione ao menos uma linha",                                                                                                                                                                                                             
			          textAlign: 'Center',                                                                                                                                                                                                                              
			          width: '100%'                                                                                                                                                                                                                                     
			        }), {                                                                                                                                                                                                                                               
			          title: "Information",                                                                                                                                                                                                                             
			          icon: MessageBox.Icon.INFORMATION,                                                                                                                                                                                                                
			         // styleClass: sCozy                                                                                                                                                                                                                               
			        });                                                                                                                                                                                                                                                 
			 } else {                                                                                                                                                                                                                                                   
				 this.getInsumoSimStorDia().open();                                                                                                                                                                                                                        
			 }                                                                                                                                                                                                                                                          
		},                                                                                                                                                                                                                                                           
		onSaveInsSimStorLoc : function(oEvent){                                                                                                                                                                                                                      
			var oInsumosTable = this.byId(sap.ui.core.Fragment.createId("idFrag", "idTabProdSimilar"));                                                                                                                                                                 
			var storageLoc = sap.ui.getCore().getModel("recProd2Details").getProperty("/Lgort");                                                                                                                                                                        
			 var receitaModel = sap.ui.getCore().getModel("receitaSimilar");                                                                                                                                                                                            
			var aIndex = oInsumosTable.getSelectedIndices();                                                                                                                                                                                                            
			aIndex.forEach(function (index, i) {                                                                                                                                                                                                                        
				var oContext = oInsumosTable.getContextByIndex(aIndex[i]); // get context                                                                                                                                                                                  
				oContext.getModel().setProperty("/receitaSimilar/" + aIndex[i] + "/Lgort",storageLoc);                                                                                                                                                                     
			});                                                                                                                                                                                                                                                         
			receitaModel.refresh();                                                                                                                                                                                                                                     
			oInsumosTable.setSelectedIndex(-1);                                                                                                                                                                                                                         
			this.onCloseDialog1(oEvent); // close dialog by btn id                                                                                                                                                                                                      
                                                                                                                                                                                                                                                               
		},                                                                                                                                                                                                                                                           
		/* Get Dose fragment */                                                                                                                                                                                                                                      
		oDiaDoseInsSim : null,                                                                                                                                                                                                                                       
		getDoseInsSimDia: function () {                                                                                                                                                                                                                              
			if (!this.oDiaDoseInsSim) {                                                                                                                                                                                                                                 
				this.oDiaDoseInsSim = sap.ui.xmlfragment(this.createId("idFrag"), "com.vistex.zagriplan.view.DoseInsumSim", this.getView().getController());                                                                                                               
				//	this.getView().addDependent(this.oDiaSchedule);                                                                                                                                                                                                         
			}                                                                                                                                                                                                                                                           
			return this.oDiaDoseInsSim;                                                                                                                                                                                                                                 
		},                                                                                                                                                                                                                                                           
		onDoseInsSim : function(oEvent){                                                                                                                                                                                                                             
			 var oTable = this.byId(sap.ui.core.Fragment.createId("idFrag", "idTabProdSimilar"));                                                                                                                                                                       
			 var aSelIndex = oTable.getSelectedIndices();                                                                                                                                                                                                               
			 if (aSelIndex.length === 0) { // no selection                                                                                                                                                                                                              
			        MessageBox.show(new sap.m.Text({                                                                                                                                                                                                                    
			          text: "Selecione ao menos uma linha",                                                                                                                                                                                                             
			          textAlign: 'Center',                                                                                                                                                                                                                              
			          width: '100%'                                                                                                                                                                                                                                     
			        }), {                                                                                                                                                                                                                                               
			          title: "Information",                                                                                                                                                                                                                             
			          icon: MessageBox.Icon.INFORMATION,                                                                                                                                                                                                                
			         // styleClass: sCozy                                                                                                                                                                                                                               
			        });                                                                                                                                                                                                                                                 
			 } else {                                                                                                                                                                                                                                                   
				 sap.ui.getCore().getModel("gm").setProperty("/detail3/doseInsumoSim","")                                                                                                                                                                                  
				 this.getDoseInsSimDia().open();                                                                                                                                                                                                                           
			 }                                                                                                                                                                                                                                                          
		},                                                                                                                                                                                                                                                           
		onSaveDoseInsSim : function(oEvent){                                                                                                                                                                                                                         
			var oInsumosTable = this.byId(sap.ui.core.Fragment.createId("idFrag", "idTabProdSimilar"));                                                                                                                                                                 
			var sDose = sap.ui.getCore().getModel("gm").getProperty("/detail3/doseInsumoSim");                                                                                                                                                                          
			 var receitaModel = sap.ui.getCore().getModel("receitaSimilar");                                                                                                                                                                                            
			var aIndex = oInsumosTable.getSelectedIndices();                                                                                                                                                                                                            
			aIndex.forEach(function (index, i) {                                                                                                                                                                                                                        
				var oContext = oInsumosTable.getContextByIndex(aIndex[i]); // get context                                                                                                                                                                                  
				oContext.getModel().setProperty("/receitaSimilar/" + aIndex[i] + "/RcdosSim",sDose);                                                                                                                                                                       
			});                                                                                                                                                                                                                                                         
			receitaModel.refresh();                                                                                                                                                                                                                                     
			oInsumosTable.setSelectedIndex(-1);                                                                                                                                                                                                                         
			this.onCloseDialog1(oEvent); // close dialog by btn id                                                                                                                                                                                                      
		},                                                                                                                                                                                                                                                           
		ondeleteInsSim : function(){                                                                                                                                                                                                                                 
			 var oModel1 = new ODataModel("/sap/opu/odata/sap/ZFARM_AGRIPLAN_SRV/");                                                                                                                                                                                    
		      var oTable = this.byId(sap.ui.core.Fragment.createId("idFrag", "idTabProdSimilar"));                                                                                                                                                                   
		      var terrenos = this.oView.byId("table2").getModel().getData().table2;                                                                                                                                                                                  
			  var receita = this.byId(sap.ui.core.Fragment.createId("idFrag", "idReceita"));                                                                                                                                                                            
		      var aSelIndex = oTable.getSelectedIndices();                                                                                                                                                                                                           
		      var arr= [];                                                                                                                                                                                                                                           
		    //  var sCozy = this.getOwnerComponent().getContentDensityClass();                                                                                                                                                                                       
		      //var oModel = oTable.getModel(oTable.getBindingInfo("rows").model);                                                                                                                                                                                   
		      var oBinding = oTable.getBindingInfo("rows");                                                                                                                                                                                                          
		      var oModel = oTable.getModel(oBinding.model);                                                                                                                                                                                                          
		      var aData = oModel.getProperty(oBinding.path);                                                                                                                                                                                                         
		      if (aSelIndex.length === 0) { // no selection                                                                                                                                                                                                          
		        MessageBox.show(new sap.m.Text({                                                                                                                                                                                                                     
		          text: "Selecione ao menos uma linha",                                                                                                                                                                                                              
		          textAlign: 'Center',                                                                                                                                                                                                                               
		          width: '100%'                                                                                                                                                                                                                                      
		        }), {                                                                                                                                                                                                                                                
		          title: "Information",                                                                                                                                                                                                                              
		          icon: MessageBox.Icon.INFORMATION,                                                                                                                                                                                                                 
		         // styleClass: sCozy                                                                                                                                                                                                                                
		        });                                                                                                                                                                                                                                                  
		      } else {                                                                                                                                                                                                                                               
		        var fnDeleteRecord = function(oAction) {                                                                                                                                                                                                             
		          if (oAction === "OK") {                                                                                                                                                                                                                            
		            aSelIndex.sort(function(a, b) {                                                                                                                                                                                                                  
		              if (a < b) {                                                                                                                                                                                                                                   
		                return 1;                                                                                                                                                                                                                                    
		              } else if (a > b) {                                                                                                                                                                                                                            
		                return -1;                                                                                                                                                                                                                                   
		              } else {                                                                                                                                                                                                                                       
		                return 0;                                                                                                                                                                                                                                    
		              }                                                                                                                                                                                                                                              
		            });                                                                                                                                                                                                                                              
		            aSelIndex.forEach(function(index) {                                                                                                                                                                                                              
		              var sPath1 = oTable.getContextByIndex(index).getPath();                                                                                                                                                                                        
		              var index1 = sPath1.match(/\d+/g);                                                                                                                                                                                                             
		              aData.splice(parseInt(index1[0], 10), 1);                                                                                                                                                                                                      
		              var oContext = oTable.getContextByIndex(index); // get context                                                                                                                                                                                 
						//var loevm = oContext.getModel().setProperty(oContext.sPath + "/Loevm","X");                                                                                                                                                                            
						oContext.getModel().setProperty("/receitaSimilar/" + index + "/Loevm","X");                                                                                                                                                                              
						var selectedData = oContext.getModel().getProperty("/receitaSimilar/" + index);                                                                                                                                                                          
			             arr.push(selectedData);                                                                                                                                                                                                                        
		            });                                                                                                                                                                                                                                              
		            console.log(arr);                                                                                                                                                                                                                                
		            //oModel.setData(aData);                                                                                                                                                                                                                         
		            oModel.refresh();                                                                                                                                                                                                                                
		            oTable.setSelectedIndex(-1);                                                                                                                                                                                                                     
					for (var x = 0; x < arr.length; x++) {                                                                                                                                                                                                                    
								var dados = {};                                                                                                                                                                                                                                        
								var total = 0;                                                                                                                                                                                                                                         
								dados.Werks = sap.ui.getCore().dadosMaster.Werks;                                                                                                                                                                                                      
								dados.Acnum = sap.ui.getCore().dadosMaster.Acnum;                                                                                                                                                                                                      
								dados.Extwg = sap.ui.getCore().dadosProcessoId;                                                                                                                                                                                                        
								dados.Matkl = sap.ui.getCore().dadosDetail.Matkl;                                                                                                                                                                                                      
								//dados.TplnrFl = that.terrenos[x].Talhao;                                                                                                                                                                                                             
								dados.TplnrFl = arr[x].TplnrFl;                                                                                                                                                                                                                        
								//dados.Data = that.terrenos[x].Data;                                                                                                                                                                                                                  
								dados.Data = terrenos[0].Data;                                                                                                                                                                                                                         
								dados.Rcnum = receita.getSelectedKey();                                                                                                                                                                                                                
								dados.MatnrIns = arr[x].MatnrSim;                                                                                                                                                                                                                      
								dados.Rcdos = arr[x].RcdosSim;                                                                                                                                                                                                                         
								dados.Lgort = arr[x].Lgort;                                                                                                                                                                                                                            
								dados.Loevm = arr[x].Loevm;                                                                                                                                                                                                                            
								oModel1.create("/SetReceitasSet", dados);                                                                                                                                                                                                              
					}                                                                                                                                                                                                                                                         
		          }                                                                                                                                                                                                                                                  
		        }                                                                                                                                                                                                                                                    
		        MessageBox.confirm("Voc realmente deseja excluir os registros selecionados?", {                                                                                                                                                                     
		          title: "Confirm",                                                                                                                                                                                                                                  
		          onClose: fnDeleteRecord,                                                                                                                                                                                                                           
		          textDirection: sap.ui.core.TextDirection.Inherit                                                                                                                                                                                                   
		        });                                                                                                                                                                                                                                                  
		      }                                                                                                                                                                                                                                                      
		},                                                                                                                                                                                                                                                           
		/*---------------------------- F4 LOGIC --------------------------------------*/                                                                                                                                                                             
		cMultiInputId: null, // current selected multiinput id/**                                                                                                                                                                                                    
		/**                                                                                                                                                                                                                                                          
		 * Fetches model from suggestion items and copy to seldiadata model and open select dialog. Common for all F4s.                                                                                                                                              
		 * @param {object} oEvent - Object of the source control.                                                                                                                                                                                                    
		 * @public                                                                                                                                                                                                                                                   
		 */                                                                                                                                                                                                                                                          
		onSelectf4: function (oEvent) {                                                                                                                                                                                                                              
			this.cMultiInputId = oEvent.getParameters().id;                                                                                                                                                                                                             
			//	var dialogId = sap.ui.getCore().byId(this.cMultiInputId).getAriaLabelledBy()[0].toString();*/                                                                                                                                                            
			if (!this.oSelDialog) {                                                                                                                                                                                                                                     
				this.oSelDialog = sap.ui.xmlfragment("com.vistex.zagriplan.view.SelectDialog", this.getView().getController());                                                                                                                                            
			}                                                                                                                                                                                                                                                           
			this.oSelDialog.setVisible(true).open(); // open dialog                                                                                                                                                                                                     
			//	sap.ui.getCore().byId(dialogId).setVisible(true).open(); // open dialog                                                                                                                                                                                  
		},                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
		/**&nbsp;                                                                                                                                                                                                                                                    
		 * Set's the selected Field from it's Value Help Dialog to it's corresponding Input field. Common for all F4s.                                                                                                                                               
		 * @param {object} oEvent - Object of the source control.&nbsp;                                                                                                                                                                                              
		 * @public                                                                                                                                                                                                                                                   
		 */                                                                                                                                                                                                                                                          
		onSelectf4val: function (oEvent) {                                                                                                                                                                                                                           
			var item = oEvent.getParameters().selectedItem; // get selected item                                                                                                                                                                                        
			//var value = item.getDescription()+" ("+item.getTitle()+")";   // prepare value                                                                                                                                                                            
			var value = item.getTitle(); // prepare value                                                                                                                                                                                                               
			sap.ui.getCore().byId(this.cMultiInputId).setValue(value); // set value to multiinput                                                                                                                                                                       
			sap.ui.getCore().byId(this.cMultiInputId).setValueState(sap.ui.core.ValueState.None);                                                                                                                                                                       
			this.cMultiInputId = null; // remove current multiinput Id                                                                                                                                                                                                  
			sap.ui.getCore().byId(oEvent.getParameters().id).getBinding("items").filter(null); // clear filter                                                                                                                                                          
		},                                                                                                                                                                                                                                                           
		/**&nbsp;                                                                                                                                                                                                                                                    
		 * Searches value through the list of items in the Value Help's Select Dialog.                                                                                                                                                                               
		 * @param {object} oEvent - Object of the source control.&nbsp;                                                                                                                                                                                              
		 * @public                                                                                                                                                                                                                                                   
		 */                                                                                                                                                                                                                                                          
		onSearchF4: function (oEvent) {                                                                                                                                                                                                                              
			var oDialog = oEvent.getSource();                                                                                                                                                                                                                           
			var oFilter1 = new sap.ui.model.Filter("Lgort", sap.ui.model.FilterOperator.Contains, oEvent.getParameters().value);                                                                                                                                        
			var oFilter2 = new sap.ui.model.Filter("Lgobe", sap.ui.model.FilterOperator.Contains, oEvent.getParameters().value);                                                                                                                                        
			// var oFilter = new sap.ui.model.Filter([oFilter1, oFilter2], false);                                                                                                                                                                                      
                                                                                                                                                                                                                                                               
			var oBinding = oDialog._oList.getBinding('items');                                                                                                                                                                                                          
			oBinding.filter([oFilter1]);                                                                                                                                                                                                                                
		},                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
		/*------------- CLOSE DIALOG (COMMON) ------------------*/                                                                                                                                                                                                   
		/** Close or exit dialog on button exit in dialog                                                                                                                                                                                                            
		 * @param {object} oEvent - button press event object&nbsp;                                                                                                                                                                                                  
		 * */                                                                                                                                                                                                                                                        
		onCloseDialog1: function (oEvent) {                                                                                                                                                                                                                          
			var oSource = oEvent.getSource();                                                                                                                                                                                                                           
			if (oSource.getMetadata().getName() === "sap.m.Button") {                                                                                                                                                                                                   
				if (oSource.getParent().getMetadata().getName() === "sap.m.Dialog") {                                                                                                                                                                                      
					oSource.getParent().close();                                                                                                                                                                                                                              
				}                                                                                                                                                                                                                                                          
			}                                                                                                                                                                                                                                                           
		},                                                                                                                                                                                                                                                           
		onAddReceita: function (oEvent) {                                                                                                                                                                                                                            
			var that = this;                                                                                                                                                                                                                                            
			var line = {};                                                                                                                                                                                                                                              
			var oReceita = this.byId(sap.ui.core.Fragment.createId("idFrag", "idReceita"));                                                                                                                                                                             
			var oTab = this.byId(sap.ui.core.Fragment.createId("idFrag", "idTabProd"));                                                                                                                                                                                 
			var oTabSim = this.byId(sap.ui.core.Fragment.createId("idFrag", "idTabProdSimilar"));                                                                                                                                                                       
			var oTabOther = this.byId(sap.ui.core.Fragment.createId("idFrag", "idTabProdSimilarOther"));                                                                                                                                                                
			var lines1 = oTabSim.getSelectedIndices();                                                                                                                                                                                                                  
			var lines2 = oTabOther.getSelectedIndices();                                                                                                                                                                                                                
                                                                                                                                                                                                                                                               
			var arrayLog = [];                                                                                                                                                                                                                                          
			var rows = oTab.getVisibleRowCount();                                                                                                                                                                                                                       
			for (var x = 0; x < lines1.length; x++) {                                                                                                                                                                                                                   
				var line = {};                                                                                                                                                                                                                                             
				line.MatnrIns = oTabSim.getModel().getData().receitaSimilar[lines1[x]].MatnrSim;                                                                                                                                                                           
				line.Maktx = oTabSim.getModel().getData().receitaSimilar[lines1[x]].MaktxSim;                                                                                                                                                                              
				line.Rcdos = oTabSim.getModel().getData().receitaSimilar[lines1[x]].RcdosSim;                                                                                                                                                                              
				line.Units = oTabSim.getModel().getData().receitaSimilar[lines1[x]].UnitsSim;                                                                                                                                                                              
				line.PlntStock = oTabSim.getModel().getData().receitaSimilar[lines1[x]].PlntStock;                                                                                                                                                                         
				line.TplnrFl =  oTabSim.getModel().getData().receitaSimilar[lines1[x]].TplnrFl;                                                                                                                                                                            
				line.Lgort = oTabSim.getModel().getData().receitaSimilar[lines1[x]].LgortSim;                                                                                                                                                                              
                                                                                                                                                                                                                                                               
				var ret = jQuery.grep(oTab.getModel().getData().receitaLista, function (n, i) {                                                                                                                                                                            
					return (line.MatnrIns === n.MatnrIns);                                                                                                                                                                                                                    
				});                                                                                                                                                                                                                                                        
				// verifica se ja existe registro com mesmo id de insumo, se sim add log error e pula next                                                                                                                                                                 
				if (ret.length > 0) {                                                                                                                                                                                                                                      
					line.Status = 'E';                                                                                                                                                                                                                                        
					arrayLog.push(line);                                                                                                                                                                                                                                      
					MessageToast.show("Insumo j existe na receita", {                                                                                                                                                                                                        
						my: "center center", // default                                                                                                                                                                                                                          
						at: "center center", // default                                                                                                                                                                                                                          
					});                                                                                                                                                                                                                                                       
					continue;                                                                                                                                                                                                                                                 
				} else {                                                                                                                                                                                                                                                   
					MessageToast.show("Insumo adicionado na receita", {                                                                                                                                                                                                       
						my: "center center", // default                                                                                                                                                                                                                          
						at: "center center", // default                                                                                                                                                                                                                          
					});                                                                                                                                                                                                                                                       
					// add log success                                                                                                                                                                                                                                        
					line.Status = 'S';                                                                                                                                                                                                                                        
					arrayLog.push(line);                                                                                                                                                                                                                                      
					line.NewData = "X";                                                                                                                                                                                                                                       
					// add model                                                                                                                                                                                                                                              
					oTab.getModel().getData().receitaLista.push(line);                                                                                                                                                                                                        
					rows = rows + 1;                                                                                                                                                                                                                                          
					// add visible row                                                                                                                                                                                                                                        
					oTab.setVisibleRowCount(rows);                                                                                                                                                                                                                            
					oTab.getModel().refresh();                                                                                                                                                                                                                                
					this.calcTotalPrevisto();                                                                                                                                                                                                                                 
				}                                                                                                                                                                                                                                                          
			}                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
		},                                                                                                                                                                                                                                                           
		onChangeCentro: function (oEvent) {                                                                                                                                                                                                                          
			var enterValid = this.getText("enterValid");                                                                                                                                                                                                                
			var oTabCentro = sap.ui.getCore().getModel("modelCentro").getData().results;                                                                                                                                                                                
			var line = jQuery.grep(oTabCentro, function (n, i) {                                                                                                                                                                                                        
				//													                                                                                                                                                                                                                                            
				return (oEvent.getSource().getValue() === n.Key);                                                                                                                                                                                                          
			});                                                                                                                                                                                                                                                         
			if (line.length > 0) {                                                                                                                                                                                                                                      
				if (oEvent.getSource().getValueState() === 'Error') {                                                                                                                                                                                                      
					oEvent.getSource().setValueState('None');                                                                                                                                                                                                                 
					oEvent.getSource().setValueStateText('');                                                                                                                                                                                                                 
				}                                                                                                                                                                                                                                                          
				var value = oEvent.getSource().getValue();                                                                                                                                                                                                                 
				oEvent.getSource().setValue("");                                                                                                                                                                                                                           
				oEvent.getSource().addToken(new sap.m.Token({                                                                                                                                                                                                              
					key: line[0].Key,                                                                                                                                                                                                                                         
					text: line[0].Key                                                                                                                                                                                                                                         
				}));                                                                                                                                                                                                                                                       
			} else {                                                                                                                                                                                                                                                    
				oEvent.getSource().setValueState('Error');                                                                                                                                                                                                                 
				oEvent.getSource().setValueStateText(enterValid);                                                                                                                                                                                                          
			}                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
		},                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
		onClear: function (oEvent) {                                                                                                                                                                                                                                 
			this.byId(sap.ui.core.Fragment.createId("idFrag", "idTabProdSimilarOther")).unbindRows();                                                                                                                                                                   
			this.byId(sap.ui.core.Fragment.createId("idFrag", "idCentro")).removeAllTokens();                                                                                                                                                                           
		},                                                                                                                                                                                                                                                           
		onFilterCentro: function (oEvent) {                                                                                                                                                                                                                          
                                                                                                                                                                                                                                                               
			var that = this;                                                                                                                                                                                                                                            
			var oFilters = [];                                                                                                                                                                                                                                          
			var enterValid = this.getText("enterValid");                                                                                                                                                                                                                
			var oCentro = this.byId(sap.ui.core.Fragment.createId("idFrag", "idCentro"));                                                                                                                                                                               
			var oReceita = this.byId(sap.ui.core.Fragment.createId("idFrag", "idReceita"));                                                                                                                                                                             
                                                                                                                                                                                                                                                               
			if (oCentro.getTokens().length > 0) {                                                                                                                                                                                                                       
				oCentro.setValueState("None");                                                                                                                                                                                                                             
				oCentro.setValueStateText("");                                                                                                                                                                                                                             
                                                                                                                                                                                                                                                               
				for (var x = 0; x < oCentro.getTokens().length; x++) {                                                                                                                                                                                                     
					oFilters.push(new sap.ui.model.Filter("Werks", "EQ", oCentro.getTokens()[x].getKey()));                                                                                                                                                                   
				}                                                                                                                                                                                                                                                          
                                                                                                                                                                                                                                                               
				oFilters.push(new sap.ui.model.Filter("Rcnum", "EQ", oReceita.getSelectedKey()));                                                                                                                                                                          
                                                                                                                                                                                                                                                               
				this.oModel.read("/ConsultarEstoqueSet", {                                                                                                                                                                                                                 
					filters: oFilters,                                                                                                                                                                                                                                        
					success: function (oData) {                                                                                                                                                                                                                               
                                                                                                                                                                                                                                                               
						var json = new JSONModel();                                                                                                                                                                                                                              
						json.setData({                                                                                                                                                                                                                                           
							receitaLista: oData.results                                                                                                                                                                                                                             
						});                                                                                                                                                                                                                                                      
						var tab = that.byId(sap.ui.core.Fragment.createId("idFrag", "idTabProdSimilarOther"));                                                                                                                                                                   
						tab.setVisibleRowCount(oData.results.length);                                                                                                                                                                                                            
						tab.setModel(json);                                                                                                                                                                                                                                      
						tab.bindRows("/receitaLista");                                                                                                                                                                                                                           
						that.calcTotalPrevisto();                                                                                                                                                                                                                                
					},                                                                                                                                                                                                                                                        
					error: function (oError) {                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                               
					}                                                                                                                                                                                                                                                         
				});                                                                                                                                                                                                                                                        
			} else {                                                                                                                                                                                                                                                    
				oCentro.setValueState("Error");                                                                                                                                                                                                                            
				oCentro.setValueStateText(enterValid);                                                                                                                                                                                                                     
			}                                                                                                                                                                                                                                                           
		},                                                                                                                                                                                                                                                           
		onSaveReceita: function (oEvent) {                                                                                                                                                                                                                           
			sap.ui.core.BusyIndicator.show(0);                                                                                                                                                                                                                          
			var that = this;                                                                                                                                                                                                                                            
			var oModel1 = new ODataModel("/sap/opu/odata/sap/ZFARM_AGRIPLAN_SRV/");                                                                                                                                                                                     
			this.terrenos = this.oView.byId("table2").getModel().getData().table2;                                                                                                                                                                                      
			this.receita = this.byId(sap.ui.core.Fragment.createId("idFrag", "idReceita"));                                                                                                                                                                             
			this.insumos = this.byId(sap.ui.core.Fragment.createId("idFrag", "idTabProd")).getModel().getData().receitaLista;                                                                                                                                           
			var isEmpty = this.insumos.some(function(item){                                                                                                                                                                                                             
				return item.Lgort === "";                                                                                                                                                                                                                                  
			});                                                                                                                                                                                                                                                         
			if(isEmpty){                                                                                                                                                                                                                                                
				var msgTitle = "A coluna Depsito  de preenchimento obrigatrio!";                                                                                                                                                                                        
				var infoTitle = that.getText("infoTitle");                                                                                                                                                                                                                 
				MessageBox.show(msgTitle, {                                                                                                                                                                                                                                
					title: infoTitle,                                                                                                                                                                                                                                         
					icon: MessageBox.Icon.INFORMATION                                                                                                                                                                                                                         
				});                                                                                                                                                                                                                                                        
				sap.ui.core.BusyIndicator.hide(0);                                                                                                                                                                                                                         
               return;                                                                                                                                                                                                                                         
			}                                                                                                                                                                                                                                                           
			// Selecionar dados de receita&nbsp;                                                                                                                                                                                                                        
			for (var z = 0; z < this.oView.getModel("receitas").getData().results.length; z++) {                                                                                                                                                                        
				if (this.oView.getModel("receitas").getData().results[z].Rcnum === this.receita.getSelectedKey()) {                                                                                                                                                        
					this.receitaLine = this.oView.getModel("receitas").getData().results[z];                                                                                                                                                                                  
					break;                                                                                                                                                                                                                                                    
				}                                                                                                                                                                                                                                                          
			}                                                                                                                                                                                                                                                           
			var oFilters = [];                                                                                                                                                                                                                                          
			var sTalhao;                                                                                                                                                                                                                                                
			var sDate;                                                                                                                                                                                                                                                  
			var oTable2 = this.oView.byId("table2");                                                                                                                                                                                                                    
			var aIndex = oTable2.getSelectedIndices();                                                                                                                                                                                                                  
			aIndex.forEach(function (index, i) {                                                                                                                                                                                                                        
				var oContext = oTable2.getContextByIndex(aIndex[i]); // get context                                                                                                                                                                                        
				sTalhao = oContext.getProperty("Talhao"); // get terrain                                                                                                                                                                                                   
				//selectedTerrains.push(sTalhao);                                                                                                                                                                                                                          
				sDate = oContext.getProperty("Data");                                                                                                                                                                                                                      
			});                                                                                                                                                                                                                                                         
			oFilters.push(new sap.ui.model.Filter("TplnrFl", "EQ", sTalhao));                                                                                                                                                                                           
			oFilters.push(new sap.ui.model.Filter("Data", "EQ", sDate));                                                                                                                                                                                                
			oFilters.push(new sap.ui.model.Filter("Acnum", "EQ", sap.ui.getCore().dadosMaster.Acnum));                                                                                                                                                                  
			oFilters.push(new sap.ui.model.Filter("Extwg", "EQ", sap.ui.getCore().dadosProcessoId));                                                                                                                                                                    
			oFilters.push(new sap.ui.model.Filter("Matkl", "EQ", sap.ui.getCore().dadosDetail.Matkl));                                                                                                                                                                  
			oFilters.push(new sap.ui.model.Filter("Rcnum", "EQ", this.receita.getSelectedKey()));                                                                                                                                                                       
                                                                                                                                                                                                                                                               
			//for (var x = 0; x < that.terrenos.length; x++) {                                                                                                                                                                                                          
			debugger;                                                                                                                                                                                                                                                   
                                                                                                                                                                                                                                                               
			this.oModel.read("/CheckTerrainSet", {                                                                                                                                                                                                                      
				filters: oFilters,                                                                                                                                                                                                                                         
				success: function (oData1) {                                                                                                                                                                                                                               
					var resMsg = oData1.results[0].Descr;                                                                                                                                                                                                                     
					if (resMsg !== "") {                                                                                                                                                                                                                                      
						var msgTitle = that.getText("infoTitle");                                                                                                                                                                                                                
						MessageBox.show(resMsg, {                                                                                                                                                                                                                                
							title: msgTitle,                                                                                                                                                                                                                                        
							icon: MessageBox.Icon.INFORMATION                                                                                                                                                                                                                       
						});                                                                                                                                                                                                                                                      
						sap.ui.core.BusyIndicator.hide();                                                                                                                                                                                                                        
					} else {                                                                                                                                                                                                                                                  
						for (var y = 0; y < that.insumos.length; y++) {                                                                                                                                                                                                          
							var dados = {};                                                                                                                                                                                                                                         
							var total = 0;                                                                                                                                                                                                                                          
							dados.Werks = sap.ui.getCore().dadosMaster.Werks;                                                                                                                                                                                                       
							dados.Acnum = sap.ui.getCore().dadosMaster.Acnum;                                                                                                                                                                                                       
							dados.Extwg = sap.ui.getCore().dadosProcessoId;                                                                                                                                                                                                         
							dados.Matkl = sap.ui.getCore().dadosDetail.Matkl;                                                                                                                                                                                                       
							//dados.TplnrFl = that.terrenos[x].Talhao;                                                                                                                                                                                                              
							dados.TplnrFl = that.insumos[y].TplnrFl;                                                                                                                                                                                                                
							//dados.Data = that.terrenos[x].Data;                                                                                                                                                                                                                   
							dados.Data = that.terrenos[0].Data;                                                                                                                                                                                                                     
							dados.Rcnum = that.receita.getSelectedKey();                                                                                                                                                                                                            
							dados.MatnrIns = that.insumos[y].MatnrIns;                                                                                                                                                                                                              
							dados.Rcdos = that.insumos[y].Rcdos;                                                                                                                                                                                                                    
							dados.Lgort = that.insumos[y].Lgort;                                                                                                                                                                                                                    
                                                                                                                                                                                                                                                               
							// calcular total de dosagem por terreno                                                                                                                                                                                                                
							switch (that.receitaLine.Ausme) {                                                                                                                                                                                                                       
							case 'VC': // Volume de calda                                                                                                                                                                                                                           
								for (var a = 0; a < sap.ui.getCore().volumeCalda.length; a++) {                                                                                                                                                                                        
									//if (sap.ui.getCore().volumeCalda[a].TplnrFl === that.terrenos[x].TplnrFl) {                                                                                                                                                                         
									if (sap.ui.getCore().volumeCalda[a].TplnrFl === that.insumos[y].TplnrFl) {                                                                                                                                                                            
										total = parseFloat(sap.ui.getCore().volumeCalda[a].Acqtb) * that.insumos[y].Rcdos;                                                                                                                                                                   
										dados.Rcdos = total;                                                                                                                                                                                                                                 
									}                                                                                                                                                                                                                                                     
								}                                                                                                                                                                                                                                                      
								break;                                                                                                                                                                                                                                                 
							case 'HC': // Hectare                                                                                                                                                                                                                                   
                                                                                                                                                                                                                                                               
								for (a = 0; a < sap.ui.getCore().volumeCalda.length; a++) {                                                                                                                                                                                            
									//if (sap.ui.getCore().volumeCalda[a].TplnrFl === that.terrenos[x].TplnrFl) {                                                                                                                                                                         
									if (sap.ui.getCore().volumeCalda[a].TplnrFl === that.insumos[y].TplnrFl) {                                                                                                                                                                            
										total = parseFloat(sap.ui.getCore().volumeCalda[a].Acarx) * that.insumos[y].Rcdos;                                                                                                                                                                   
										dados.Rcdos = total;                                                                                                                                                                                                                                 
									}                                                                                                                                                                                                                                                     
								}                                                                                                                                                                                                                                                      
                                                                                                                                                                                                                                                               
								break;                                                                                                                                                                                                                                                 
							default:                                                                                                                                                                                                                                                
							}                                                                                                                                                                                                                                                       
							dados.Rcdos = dados.Rcdos.toString();                                                                                                                                                                                                                   
							oModel1.create("/SetReceitasSet", dados);                                                                                                                                                                                                               
						}                                                                                                                                                                                                                                                        
						var produtoSimilarM = that.byId(sap.ui.core.Fragment.createId("idFrag", "idTabProdSimilar")).getModel().getData().receitaSimilar;                                                                                                                        
						//for (var j = 0; j < that.terrenos.length; j++) {                                                                                                                                                                                                       
						//oFilters.push(new sap.ui.model.Filter("TplnrFl", "EQ", this.terrenos[j].Talhao));                                                                                                                                                                      
						debugger;                                                                                                                                                                                                                                                
						for (var k = 0; k < produtoSimilarM.length; k++) {                                                                                                                                                                                                       
							var dados1 = {};                                                                                                                                                                                                                                        
						//	var total = 0;                                                                                                                                                                                                                                        
							dados1.Werks = sap.ui.getCore().dadosMaster.Werks;                                                                                                                                                                                                      
							dados1.Acnum = sap.ui.getCore().dadosMaster.Acnum;                                                                                                                                                                                                      
							dados1.Extwg = sap.ui.getCore().dadosProcessoId;                                                                                                                                                                                                        
							dados1.Matkl = sap.ui.getCore().dadosDetail.Matkl;                                                                                                                                                                                                      
							//dados1.TplnrFl = that.terrenos[j].Talhao;                                                                                                                                                                                                             
							dados1.TplnrFl = produtoSimilarM[k].TplnrFl;                                                                                                                                                                                                            
							//dados1.Data = that.terrenos[j].Data;                                                                                                                                                                                                                  
							dados1.Data = that.terrenos[0].Data;                                                                                                                                                                                                                    
							dados1.Rcnum = that.receita.getSelectedKey();                                                                                                                                                                                                           
							dados1.MatnrIns = produtoSimilarM[k].MatnrIns;                                                                                                                                                                                                          
							dados1.RcdosSim = produtoSimilarM[k].RcdosSim;                                                                                                                                                                                                          
							dados1.MatnrSim = produtoSimilarM[k].MatnrSim;                                                                                                                                                                                                          
							dados1.LgortSim = produtoSimilarM[k].LgortSim;                                                                                                                                                                                                          
							oModel1.create("/SetProdutoSimilarSet", dados1);                                                                                                                                                                                                        
						}                                                                                                                                                                                                                                                        
						oModel1.submitChanges();                                                                                                                                                                                                                                 
						oModel1.attachBatchRequestCompleted(function (oData, fnFunction, oListener) {                                                                                                                                                                            
							//	console.log(oData,fnFunction,oListener);                                                                                                                                                                                                             
							var bCompact = !!that.getView().$().closest(".sapUiSizeCompact").length;                                                                                                                                                                                
							sap.ui.core.BusyIndicator.hide();                                                                                                                                                                                                                       
							MessageBox.success(                                                                                                                                                                                                                                     
								"Receita salva com sucesso", {                                                                                                                                                                                                                         
									styleClass: bCompact ? "sapUiSizeCompact" : ""                                                                                                                                                                                                        
								}                                                                                                                                                                                                                                                      
							);                                                                                                                                                                                                                                                      
						});                                                                                                                                                                                                                                                      
                                                                                                                                                                                                                                                               
					}                                                                                                                                                                                                                                                         
				}                                                                                                                                                                                                                                                          
			});                                                                                                                                                                                                                                                         
			//}                                                                                                                                                                                                                                                         
                                                                                                                                                                                                                                                               
			//}                                                                                                                                                                                                                                                         
			//                                                                            dados.Rcdos = insumos[y].TotalPrev;                                                                                                                                           
                                                                                                                                                                                                                                                               
			//},                                                                                                                                                                                                                                                        
                                                                                                                                                                                                                                                               
			//		});                                                                                                                                                                                                                                                     
                                                                                                                                                                                                                                                               
		},                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
		onSaveProg: function (oEvent) {                                                                                                                                                                                                                              
                                                                                                                                                                                                                                                               
			var that = this;                                                                                                                                                                                                                                            
			var oModel = models.callBackEnd();                                                                                                                                                                                                                          
                                                                                                                                                                                                                                                               
			if (this.oView.byId("table2").getModel().getData().table2.length < 0) {                                                                                                                                                                                     
                                                                                                                                                                                                                                                               
				MessageToast.show("Sem talhes programados", {                                                                                                                                                                                                             
					my: "center center", // default                                                                                                                                                                                                                           
					at: "center center", // default                                                                                                                                                                                                                           
				});                                                                                                                                                                                                                                                        
                                                                                                                                                                                                                                                               
			} else {                                                                                                                                                                                                                                                    
                                                                                                                                                                                                                                                               
				for (var x = 0; x < this.oView.byId("table2").getModel().getData().table2.length; x++) {                                                                                                                                                                   
                                                                                                                                                                                                                                                               
					var line = {};                                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                               
					line.Acnum = sap.ui.getCore().dadosMaster.Acnum;                                                                                                                                                                                                          
					line.Extwg = sap.ui.getCore().dadosProcessoId;                                                                                                                                                                                                            
					line.Matkl = sap.ui.getCore().dadosDetail.Matkl;                                                                                                                                                                                                          
					line.TplnrFl = this.oView.byId("table2").getModel().getData().table2[x].Talhao;                                                                                                                                                                           
					line.Data = this.oView.byId("table2").getModel().getData().table2[x].Data;                                                                                                                                                                                
					line.Aarea = this.oView.byId("table2").getModel().getData().table2[x].Aarea;                                                                                                                                                                              
					line.Cmnum = this.oView.byId("table2").getModel().getData().table2[x].Cmnum;                                                                                                                                                                              
					line.Loevm = this.oView.byId("table2").getModel().getData().table2[x].Loevm;                                                                                                                                                                              
					line.Aufnr = this.oView.byId("table2").getModel().getData().table2[x].Aufnr;                                                                                                                                                                              
					oModel.create("/SetProgTalhaoSet", line);                                                                                                                                                                                                                 
				}                                                                                                                                                                                                                                                          
			}                                                                                                                                                                                                                                                           
			if (this.delFlag === "X") {                                                                                                                                                                                                                                 
				var deleteModelL = sap.ui.getCore().getModel("deleteM").getData();                                                                                                                                                                                         
				for (var y = 0; y < deleteModelL.length; y++) {                                                                                                                                                                                                            
					var line1 = {};                                                                                                                                                                                                                                           
					line1.Acnum = sap.ui.getCore().dadosMaster.Acnum;                                                                                                                                                                                                         
					line1.Extwg = sap.ui.getCore().dadosProcessoId;                                                                                                                                                                                                           
					line1.Matkl = sap.ui.getCore().dadosDetail.Matkl;                                                                                                                                                                                                         
					line1.TplnrFl = sap.ui.getCore().getModel("deleteM").getData()[y].Talhao;                                                                                                                                                                                 
					line1.Data = sap.ui.getCore().getModel("deleteM").getData()[y].Data;                                                                                                                                                                                      
					line1.Aarea = sap.ui.getCore().getModel("deleteM").getData()[y].Aarea;                                                                                                                                                                                    
					line1.Cmnum = sap.ui.getCore().getModel("deleteM").getData()[y].Cmnum;                                                                                                                                                                                    
					line1.Loevm = sap.ui.getCore().getModel("deleteM").getData()[y].Loevm;                                                                                                                                                                                    
					line1.Aufnr = sap.ui.getCore().getModel("deleteM").getData()[y].Aufnr;                                                                                                                                                                                    
					if (line1.Loevm === "X") {                                                                                                                                                                                                                                
						oModel.create("/SetProgTalhaoSet", line1);                                                                                                                                                                                                               
					}                                                                                                                                                                                                                                                         
				}                                                                                                                                                                                                                                                          
                                                                                                                                                                                                                                                               
			}                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
			oModel.submitChanges();                                                                                                                                                                                                                                     
			oModel.attachBatchRequestCompleted(function (oData, fnFunction, oListener) {                                                                                                                                                                                
				var bCompact = !!that.getView().$().closest(".sapUiSizeCompact").length;                                                                                                                                                                                   
				MessageBox.success(                                                                                                                                                                                                                                        
					"Talhes programados com sucesso", {                                                                                                                                                                                                                      
						styleClass: bCompact ? "sapUiSizeCompact" : ""                                                                                                                                                                                                           
					}                                                                                                                                                                                                                                                         
				);                                                                                                                                                                                                                                                         
			});                                                                                                                                                                                                                                                         
			this.delFlag = "";                                                                                                                                                                                                                                          
                                                                                                                                                                                                                                                               
		},                                                                                                                                                                                                                                                           
		/**                                                                                                                                                                                                                                                          
		 * Convenience method for getting the resource bundle.                                                                                                                                                                                                       
		 * @public                                                                                                                                                                                                                                                   
		 * @returns {sap.ui.model.resource.ResourceModel} the resourceModel of the component                                                                                                                                                                         
		 */                                                                                                                                                                                                                                                          
		getResourceBundle: function () {                                                                                                                                                                                                                             
			return this.getOwnerComponent().getModel("i18n").getResourceBundle();                                                                                                                                                                                       
		},                                                                                                                                                                                                                                                           
		/**                                                                                                                                                                                                                                                          
		 * Convenience method for getting text from i18n                                                                                                                                                                                                             
		 * @param {string} key - accept key as string                                                                                                                                                                                                                
		 * @param {string} args - accept args                                                                                                                                                                                                                        
		 * @returns {string} - return string value of key from i18n                                                                                                                                                                                                  
		 * */                                                                                                                                                                                                                                                        
		getText: function (key, args) {                                                                                                                                                                                                                              
			return this.getResourceBundle().getText(key, args);                                                                                                                                                                                                         
		},                                                                                                                                                                                                                                                           
		onCreateTaskConfirm: function () {                                                                                                                                                                                                                           
			if (this.oView.byId("table2").getSelectedIndex() === -1) {                                                                                                                                                                                                  
				MessageToast.show("Selecionar terreno", {                                                                                                                                                                                                                  
					my: "center center", // default                                                                                                                                                                                                                           
					at: "center center" // default                                                                                                                                                                                                                            
				});                                                                                                                                                                                                                                                        
			} else {                                                                                                                                                                                                                                                    
				var selectedTerrains = [];                                                                                                                                                                                                                                 
				var oTable2 = this.oView.byId("table2");                                                                                                                                                                                                                   
				var aIndex = oTable2.getSelectedIndices();                                                                                                                                                                                                                 
				aIndex.forEach(function (index, i) {                                                                                                                                                                                                                       
					var oContext = oTable2.getContextByIndex(aIndex[i]); // get context                                                                                                                                                                                       
					var sTalhao = oContext.getProperty("Talhao"); // get terrain                                                                                                                                                                                              
					selectedTerrains.push(sTalhao);                                                                                                                                                                                                                           
				});                                                                                                                                                                                                                                                        
				var msg = this.getText("OrderReleaseConfirm");                                                                                                                                                                                                             
				var msgTitle = this.getText("confirmationAction");                                                                                                                                                                                                         
				var thiz = this;                                                                                                                                                                                                                                           
				sap.m.MessageBox.show(selectedTerrains.join(", ") + " " + msg, {                                                                                                                                                                                           
					icon: sap.m.MessageBox.Icon.QUESTION,                                                                                                                                                                                                                     
					title: msgTitle,                                                                                                                                                                                                                                          
					actions: [sap.m.MessageBox.Action.YES, sap.m.MessageBox.Action.NO],                                                                                                                                                                                       
					onClose: function (oAction) {                                                                                                                                                                                                                             
						if (oAction === "Sim" || oAction === "YES") {                                                                                                                                                                                                            
							thiz.onCreateTask();                                                                                                                                                                                                                                    
							oTable2.setSelectedIndex(-1);                                                                                                                                                                                                                           
							//   model.getAllTableData();                                                                                                                                                                                                                           
							//  thiz.loadData();                                                                                                                                                                                                                                    
							// model.getAllTableData();                                                                                                                                                                                                                             
						} else if (oAction === "No" || oAction === "NO") {                                                                                                                                                                                                      
							oTable2.setSelectedIndex(-1);                                                                                                                                                                                                                           
							return;                                                                                                                                                                                                                                                 
						}                                                                                                                                                                                                                                                        
					}                                                                                                                                                                                                                                                         
				});                                                                                                                                                                                                                                                        
			}                                                                                                                                                                                                                                                           
		},                                                                                                                                                                                                                                                           
		onCreateTask: function (oEvent) {                                                                                                                                                                                                                            
			var that = this;                                                                                                                                                                                                                                            
			var oFilters = [];                                                                                                                                                                                                                                          
			var sTalhao;                                                                                                                                                                                                                                                
			var sAufnr;                                                                                                                                                                                                                                                 
			var sDate;                                                                                                                                                                                                                                                  
			var sRcnum;                                                                                                                                                                                                                                                 
			sap.ui.core.BusyIndicator.show(0);                                                                                                                                                                                                                          
			var oTable2 = this.oView.byId("table2");                                                                                                                                                                                                                    
			var aIndex = oTable2.getSelectedIndices();                                                                                                                                                                                                                  
			aIndex.forEach(function (index, i) {                                                                                                                                                                                                                        
				var oContext = oTable2.getContextByIndex(aIndex[i]); // get context                                                                                                                                                                                        
				sTalhao = oContext.getProperty("Talhao"); // get terrain                                                                                                                                                                                                   
				sAufnr = oContext.getProperty("Aufnr");                                                                                                                                                                                                                    
				sRcnum = oContext.getProperty("Rcnum");                                                                                                                                                                                                                    
				//selectedTerrains.push(sTalhao);                                                                                                                                                                                                                          
				sDate = oContext.getProperty("Data");                                                                                                                                                                                                                      
				oFilters.push(new sap.ui.model.Filter("TplnrFl", "EQ", sTalhao));                                                                                                                                                                                          
				oFilters.push(new sap.ui.model.Filter("Data", "EQ", sDate));                                                                                                                                                                                               
				oFilters.push(new sap.ui.model.Filter("Rcnum", "EQ", sRcnum));                                                                                                                                                                                             
                                                                                                                                                                                                                                                               
			});                                                                                                                                                                                                                                                         
                                                                                                                                                                                                                                                               
			//	for (var x = 0; x < tab.length; x++) {                                                                                                                                                                                                                   
                                                                                                                                                                                                                                                               
			//}                                                                                                                                                                                                                                                         
			//  oFilters.push(new sap.ui.model.Filter("TplnrFl", "EQ", sTalhao));                                                                                                                                                                                       
                                                                                                                                                                                                                                                               
			oFilters.push(new sap.ui.model.Filter("Acnum", "EQ", sap.ui.getCore().dadosMaster.Acnum));                                                                                                                                                                  
			oFilters.push(new sap.ui.model.Filter("Ajahr", "EQ", sap.ui.getCore().dadosMaster.Ajahr));                                                                                                                                                                  
			oFilters.push(new sap.ui.model.Filter("Actyp", "EQ", sap.ui.getCore().dadosMaster.Actyp));                                                                                                                                                                  
			oFilters.push(new sap.ui.model.Filter("Extwg", "EQ", sap.ui.getCore().dadosProcessoId));                                                                                                                                                                    
			oFilters.push(new sap.ui.model.Filter("Matkl", "EQ", sap.ui.getCore().dadosDetail.Matkl));                                                                                                                                                                  
			//oFilters.push(new sap.ui.model.Filter("Rcnum", "EQ", sap.ui.getCore().Rcnum));                                                                                                                                                                            
                                                                                                                                                                                                                                                               
			this.oModel.read("/CreateOrderTaskSet", {                                                                                                                                                                                                                   
				filters: oFilters,                                                                                                                                                                                                                                         
				success: function (oData) {                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                               
					// var bCompact = !!that.getView().$().closest(".sapUiSizeCompact").length;                                                                                                                                                                               
					// MessageBox.success(                                                                                                                                                                                                                                    
					// 	"Ordem tarefa criada com sucesso", {                                                                                                                                                                                                                  
					// 		styleClass: bCompact ? "sapUiSizeCompact" : ""                                                                                                                                                                                                       
					// 	}                                                                                                                                                                                                                                                     
					// );					                                                                                                                                                                                                                                                
					var json = new JSONModel();                                                                                                                                                                                                                               
					json.setData(oData);                                                                                                                                                                                                                                      
					var oDialog = new sap.m.Dialog({                                                                                                                                                                                                                          
						draggable: true,                                                                                                                                                                                                                                         
						resizable: true,                                                                                                                                                                                                                                         
						buttons: [                                                                                                                                                                                                                                               
							new sap.m.Button({                                                                                                                                                                                                                                      
								text: "OK",                                                                                                                                                                                                                                            
								type: sap.m.ButtonType.Accepty,                                                                                                                                                                                                                        
								press: [function (oEvent) {                                                                                                                                                                                                                            
									oEvent.getSource().getParent().close();                                                                                                                                                                                                               
									//that.getTalhoesProg();                                                                                                                                                                                                                              
								}]                                                                                                                                                                                                                                                     
							})                                                                                                                                                                                                                                                      
						]                                                                                                                                                                                                                                                        
                                                                                                                                                                                                                                                               
					});                                                                                                                                                                                                                                                       
					/*	var oModel = oData.results;                                                                                                                                                                                                                            
						console.log(oModel)                                                                                                                                                                                                                                      
						var aIndexT = oTable2.getSelectedIndices();                                                                                                                                                                                                              
						aIndexT.forEach(function (index, i) {                                                                                                                                                                                                                    
							oModel.forEach(function (item) {                                                                                                                                                                                                                        
								var oContext = oTable2.getContextByIndex(aIndex[i]); // get context                                                                                                                                                                                    
								oContext.setProperty("/Aufnr", oModel[item].Aufnr);                                                                                                                                                                                                    
							});                                                                                                                                                                                                                                                     
						                                                                                                                                                                                                                                                         
						});*/                                                                                                                                                                                                                                                    
					var oModel = oData.results;                                                                                                                                                                                                                               
					var oModelT = oTable2.getModel().getData().table2;                                                                                                                                                                                                        
					oModelT.forEach(function (item, i) {                                                                                                                                                                                                                      
						var sTerrainT = oModelT[i].Talhao;                                                                                                                                                                                                                       
						oModel.forEach(function (item1, j) {                                                                                                                                                                                                                     
							var sTerrainD = oModel[j].TplnrFl;                                                                                                                                                                                                                      
							if (sTerrainT === sTerrainD) {                                                                                                                                                                                                                          
								//oModelT.setProperty("/Aufnr" + i, oModel[j].Aufnr);                                                                                                                                                                                                  
								oModelT[i].Aufnr = oModel[j].Aufnr;                                                                                                                                                                                                                    
							}                                                                                                                                                                                                                                                       
						});                                                                                                                                                                                                                                                      
					});                                                                                                                                                                                                                                                       
					oTable2.getModel().setData({                                                                                                                                                                                                                              
						table2: oModelT                                                                                                                                                                                                                                          
					});                                                                                                                                                                                                                                                       
                                                                                                                                                                                                                                                               
					// var oClose = new sap.m.Button({text:"OK", type: sap.m.ButtonType.Accepty, press: function(oEvent) {                                                                                                                                                    
					// 	sap.ui.getCore().byId(that.createId("idLog")).close();                                                                                                                                                                                                
					// }});		                                                                                                                                                                                                                                                 
					var oTable = new sap.m.Table();                                                                                                                                                                                                                           
					var oCol1 = new sap.m.Column({                                                                                                                                                                                                                            
						width: "150px",                                                                                                                                                                                                                                          
						header: new sap.m.Label({                                                                                                                                                                                                                                
							text: "Terreno"                                                                                                                                                                                                                                         
						})                                                                                                                                                                                                                                                       
					});                                                                                                                                                                                                                                                       
					var oCol2 = new sap.m.Column({                                                                                                                                                                                                                            
						width: "150px",                                                                                                                                                                                                                                          
						header: new sap.m.Label({                                                                                                                                                                                                                                
							text: "Data"                                                                                                                                                                                                                                            
						})                                                                                                                                                                                                                                                       
					});                                                                                                                                                                                                                                                       
					var oCol5 = new sap.m.Column({                                                                                                                                                                                                                            
						width: "150px",                                                                                                                                                                                                                                          
						header: new sap.m.Label({                                                                                                                                                                                                                                
							text: "Ordem"                                                                                                                                                                                                                                           
						})                                                                                                                                                                                                                                                       
					});                                                                                                                                                                                                                                                       
					var oCol3 = new sap.m.Column({                                                                                                                                                                                                                            
						width: "60px",                                                                                                                                                                                                                                           
						header: new sap.m.Label({                                                                                                                                                                                                                                
							text: "Status"                                                                                                                                                                                                                                          
						})                                                                                                                                                                                                                                                       
					});                                                                                                                                                                                                                                                       
					var oCol4 = new sap.m.Column({                                                                                                                                                                                                                            
						width: "auto",                                                                                                                                                                                                                                           
						header: new sap.m.Label({                                                                                                                                                                                                                                
							text: "Descrio"                                                                                                                                                                                                                                       
						})                                                                                                                                                                                                                                                       
					});                                                                                                                                                                                                                                                       
                                                                                                                                                                                                                                                               
					oTable.addColumn(oCol1);                                                                                                                                                                                                                                  
					oTable.addColumn(oCol2);                                                                                                                                                                                                                                  
					oTable.addColumn(oCol5);                                                                                                                                                                                                                                  
					oTable.addColumn(oCol3);                                                                                                                                                                                                                                  
					oTable.addColumn(oCol4);                                                                                                                                                                                                                                  
                                                                                                                                                                                                                                                               
					var oTemp = new sap.m.ColumnListItem();                                                                                                                                                                                                                   
                                                                                                                                                                                                                                                               
					oTemp.addCell(new sap.m.Label({                                                                                                                                                                                                                           
						text: "{modelLog>TplnrFl}"                                                                                                                                                                                                                               
					}));                                                                                                                                                                                                                                                      
					oTemp.addCell(new sap.m.Label({                                                                                                                                                                                                                           
						text: "{modelLog>Data}"                                                                                                                                                                                                                                  
					}));                                                                                                                                                                                                                                                      
					oTemp.addCell(new sap.m.Label({                                                                                                                                                                                                                           
						text: "{modelLog>Aufnr}"                                                                                                                                                                                                                                 
					}));                                                                                                                                                                                                                                                      
					oTemp.addCell(new sap.ui.core.Icon({                                                                                                                                                                                                                      
						src: {                                                                                                                                                                                                                                                   
							path: 'modelLog>Status',                                                                                                                                                                                                                                
							formatter: function (d) {                                                                                                                                                                                                                               
								//		                                                                                                                                                                                                                                                   
								if (d === "S") {                                                                                                                                                                                                                                       
									return "sap-icon://message-success";                                                                                                                                                                                                                  
								} else if (d === "W") {                                                                                                                                                                                                                                
									return "sap-icon://message-warning";                                                                                                                                                                                                                  
								} else if (d === "E") {                                                                                                                                                                                                                                
									return "sap-icon://message-error";                                                                                                                                                                                                                    
								}                                                                                                                                                                                                                                                      
							}                                                                                                                                                                                                                                                       
						},                                                                                                                                                                                                                                                       
						color: {                                                                                                                                                                                                                                                 
							path: "modelLog>Status",                                                                                                                                                                                                                                
							formatter: function (c) {                                                                                                                                                                                                                               
								//		                                                                                                                                                                                                                                                   
								if (c === "S") {                                                                                                                                                                                                                                       
									return "green";                                                                                                                                                                                                                                       
								} else if (c === "W") {                                                                                                                                                                                                                                
									return "yellow";                                                                                                                                                                                                                                      
								} else if (c === "E") {                                                                                                                                                                                                                                
									return "red";                                                                                                                                                                                                                                         
								}                                                                                                                                                                                                                                                      
							}                                                                                                                                                                                                                                                       
						}                                                                                                                                                                                                                                                        
					}));                                                                                                                                                                                                                                                      
					oTemp.addCell(new sap.m.Label({                                                                                                                                                                                                                           
						text: "{modelLog>Descr}"                                                                                                                                                                                                                                 
					}));                                                                                                                                                                                                                                                      
                                                                                                                                                                                                                                                               
					oTable.setModel(json, "modelLog");                                                                                                                                                                                                                        
                                                                                                                                                                                                                                                               
					// SET TAB MODEL&nbsp;                                                                                                                                                                                                                                    
                                                                                                                                                                                                                                                               
					oTable.bindAggregation("items", {                                                                                                                                                                                                                         
						path: "modelLog>/results",                                                                                                                                                                                                                               
						template: oTemp                                                                                                                                                                                                                                          
					});                                                                                                                                                                                                                                                       
                                                                                                                                                                                                                                                               
					oDialog.setTitle("Log");                                                                                                                                                                                                                                  
					oDialog.setContentWidth("auto");                                                                                                                                                                                                                          
					oDialog.setContentHeight("300px");                                                                                                                                                                                                                        
					oDialog.addContent(oTable);                                                                                                                                                                                                                               
					sap.ui.core                                                                                                                                                                                                                                               
						.BusyIndicator.hide();                                                                                                                                                                                                                                   
					oDialog.open();                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
				},                                                                                                                                                                                                                                                         
                                                                                                                                                                                                                                                               
				error: function (oError) {                                                                                                                                                                                                                                 
					//						                                                                                                                                                                                                                                                  
				}                                                                                                                                                                                                                                                          
			});                                                                                                                                                                                                                                                         
			//	}                                                                                                                                                                                                                                                        
                                                                                                                                                                                                                                                               
		},                                                                                                                                                                                                                                                           
		//             var that = this;                                                                                                                                                                                                                              
		// 		    var line = {};                                                                                                                                                                                                                                      
		// 		    var oModel = models.getSetProgramacao();&nbsp;                                                                                                                                                                                                      
		// 		   	oModel.setDefaultBindingMode(sap.ui.model.BindingMode.TwoWay);                                                                                                                                                                                      
		// 			oModel.setUseBatch(true);                                                                                                                                                                                                                              
                                                                                                                                                                                                                                                               
		// 		    for(var x=0; this.oView.byId("table2").getModel("modelSelect").getData().results.length; x++) {                                                                                                                                                     
                                                                                                                                                                                                                                                               
		// 				line.Acnum = sap.ui.getCore().dadosMaster.Acnum;                                                                                                                                                                                                      
		// 				line.Processo = sap.ui.getCore().dadosProcessoId;                                                                                                                                                                                                     
		// 				line.Matkl = sap.ui.getCore().dadosDetail.Matkl;                                                                                                                                                                                                      
		// 				line.Begda = this.oView.getModel("modelWeekDate").getData().Begda;                                                                                                                                                                                    
		// 				line.TplnrFl = this.oView.byId("table2").getModel("modelSelect").getData().results[x].TplnrFl;                                                                                                                                                        
		// 				line.D1h = this.oView.byId("idTabProg").getRows()[x].getCells()[1].getValue();                                                                                                                                                                        
		// 				line.D1r = this.oView.byId("idTabProg").getRows()[x].getCells()[2].getValue();                                                                                                                                                                        
		// 				line.D2h = this.oView.byId("idTabProg").getRows()[x].getCells()[3].getValue();                                                                                                                                                                        
		// 				line.D2r = this.oView.byId("idTabProg").getRows()[x].getCells()[4].getValue();                                                                                                                                                                        
		// 				line.D3h = this.oView.byId("idTabProg").getRows()[x].getCells()[5].getValue();                                                                                                                                                                        
		// 				line.D3r = this.oView.byId("idTabProg").getRows()[x].getCells()[6].getValue();                                                                                                                                                                        
		// 				line.D4h = this.oView.byId("idTabProg").getRows()[x].getCells()[7].getValue();                                                                                                                                                                        
		// 				line.D4r = this.oView.byId("idTabProg").getRows()[x].getCells()[8].getValue();                                                                                                                                                                        
		// 				line.D5h = this.oView.byId("idTabProg").getRows()[x].getCells()[9].getValue();                                                                                                                                                                        
		// 				line.D5r = this.oView.byId("idTabProg").getRows()[x].getCells()[10].getValue();	        		&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                                                                                                            
                                                                                                                                                                                                                                                               
		// 		        oModel.create("/CreateTask", line);                                                                                                                                                                                                             
                                                                                                                                                                                                                                                               
		// 		    }                                                                                                                                                                                                                                                   
                                                                                                                                                                                                                                                               
		// 			oModel.submitChanges();                                                                                                                                                                                                                                
		// 			oModel.attachBatchRequestCompleted(function (oData, fnFunction, oListener) {                                                                                                                                                                           
		// 				var bCompact = !!that.getView().$().closest(".sapUiSizeCompact").length;                                                                                                                                                                              
		// 				MessageBox.success(                                                                                                                                                                                                                                   
		// 					"Programao salva com sucesso", {                                                                                                                                                                                                                   
		// 						styleClass: bCompact ? "sapUiSizeCompact" : ""                                                                                                                                                                                                      
		// 					}                                                                                                                                                                                                                                                    
		// 				);                                                                                                                                                                                                                                                    
                                                                                                                                                                                                                                                               
		// 				                                                                                                                                                                                                                                                      
		// 			});                                                                                                                                                                                                                                                    
                                                                                                                                                                                                                                                               
		onValueHelp: function (oEvent, p) {                                                                                                                                                                                                                          
                                                                                                                                                                                                                                                               
			var that = this,                                                                                                                                                                                                                                            
				vTitle = "Centro",                                                                                                                                                                                                                                         
				vEntity = "/GetCentroSet",                                                                                                                                                                                                                                 
				vPath = "modelValueHelp>/results",                                                                                                                                                                                                                         
				vNoData = "Sem centros";                                                                                                                                                                                                                                   
			//				oObjects = .getTokens();                                                                                                                                                                                                                              
                                                                                                                                                                                                                                                               
			this.oModel.read(vEntity, {                                                                                                                                                                                                                                 
				//				filters: oFilters,                                                                                                                                                                                                                                   
				success: function (oData) {                                                                                                                                                                                                                                
					var oTab = new sap.m.TableSelectDialog({                                                                                                                                                                                                                  
						busyIndicatorDelay: 0, // int			&nbsp;&nbsp;&nbsp;&nbsp;                                                                                                                                                                                                 
						title: vTitle, // string                                                                                                                                                                                                                                 
						noDataText: vNoData,                                                                                                                                                                                                                                     
						growing: false,                                                                                                                                                                                                                                          
						rememberSelections: true,                                                                                                                                                                                                                                
						multiSelect: true, // boolean                                                                                                                                                                                                                            
						contentWidth: "450px", // sap.ui.core.CSSSize, since 1.18                                                                                                                                                                                                
						contentHeight: "400px", // sap.ui.core.CSSSize, since 1.18                                                                                                                                                                                               
						columns: [                                                                                                                                                                                                                                               
							new sap.m.Column({                                                                                                                                                                                                                                      
								header: new sap.m.Label({                                                                                                                                                                                                                              
									text: "ID"                                                                                                                                                                                                                                            
								})                                                                                                                                                                                                                                                     
							}),                                                                                                                                                                                                                                                     
							new sap.m.Column({                                                                                                                                                                                                                                      
								header: new sap.m.Label({                                                                                                                                                                                                                              
									text: "Descrio"                                                                                                                                                                                                                                     
								})                                                                                                                                                                                                                                                     
							})                                                                                                                                                                                                                                                      
						],                                                                                                                                                                                                                                                       
						confirm: [function (oEvt) {                                                                                                                                                                                                                              
							for (var x = 0; x < oEvt.getParameter("selectedItems").length; x++) {                                                                                                                                                                                   
								var key = oEvt.getParameter("selectedItems")[x].getBindingContext("modelValueHelp").getProperty("Key");                                                                                                                                                
								var descr = oEvt.getParameter("selectedItems")[x].getBindingContext("modelValueHelp").getProperty("Descr");                                                                                                                                            
								that.byId(sap.ui.core.Fragment.createId("idFrag", "idCentro")).addToken(new sap.m.Token({                                                                                                                                                              
									key: key,                                                                                                                                                                                                                                             
									text: key                                                                                                                                                                                                                                             
								}));                                                                                                                                                                                                                                                   
							}                                                                                                                                                                                                                                                       
							//                                                                                                                                                                                                                                                      
						}, this],                                                                                                                                                                                                                                                
						search: [function (e) {                                                                                                                                                                                                                                  
                                                                                                                                                                                                                                                               
						}, this],                                                                                                                                                                                                                                                
						liveChange: [function (oEvt) {                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
						}, this],                                                                                                                                                                                                                                                
						cancel: [function (g) {                                                                                                                                                                                                                                  
							//	    this.close();                                                                                                                                                                                                                                    
						}, this]                                                                                                                                                                                                                                                 
					});                                                                                                                                                                                                                                                       
                                                                                                                                                                                                                                                               
					//DEFINE TEMPLATE                                                                                                                                                                                                                                         
					var oTemp = new sap.m.ColumnListItem({                                                                                                                                                                                                                    
						cells: [                                                                                                                                                                                                                                                 
							new sap.m.Text({                                                                                                                                                                                                                                        
								text: "{modelValueHelp>Key}"                                                                                                                                                                                                                           
							}),                                                                                                                                                                                                                                                     
							new sap.m.Text({                                                                                                                                                                                                                                        
								text: "{modelValueHelp>Descr}"                                                                                                                                                                                                                         
							})                                                                                                                                                                                                                                                      
						]                                                                                                                                                                                                                                                        
					});                                                                                                                                                                                                                                                       
                                                                                                                                                                                                                                                               
					// JSON MODEL                                                                                                                                                                                                                                             
					var json = new sap.ui.model.json.JSONModel();                                                                                                                                                                                                             
					json.setSizeLimit(oData.results.length);                                                                                                                                                                                                                  
					json.setData(oData);                                                                                                                                                                                                                                      
                                                                                                                                                                                                                                                               
					// SET TAB MODEL&nbsp;                                                                                                                                                                                                                                    
					oTab.setModel(json, "modelValueHelp");                                                                                                                                                                                                                    
					oTab.bindAggregation("items", {                                                                                                                                                                                                                           
						path: vPath,                                                                                                                                                                                                                                             
						template: oTemp                                                                                                                                                                                                                                          
					});                                                                                                                                                                                                                                                       
                                                                                                                                                                                                                                                               
					// REMEMBER SELECTIONS                                                                                                                                                                                                                                    
					// 	for(var x=0; x<sap.ui.getCore().byId("idCentro").getTokens().length; x++) {                                                                                                                                                                           
					// 	    for(var y=0; y<oTab.getModel("modelValueHelp").getData().results.length; y++) {                                                                                                                                                                   
					// 	        if(sap.ui.getCore().byId("idCentro").getTokens()[x].getKey() === oTab.getModel("modelValueHelp").getData().results[y].Werks) {                                                                                                                
					// 	            oTab.getModel("modelValueHelp").getData().results[y].setSelected(true);                                                                                                                                                                   
					// 	        }                                                                                                                                                                                                                                             
					// 	    }                                                                                                                                                                                                                                                 
					// 	}                                                                                                                                                                                                                                                     
					sap.ui.core.BusyIndicator.hide();                                                                                                                                                                                                                         
					// OPEN DIALOG                                                                                                                                                                                                                                            
					oTab.open();                                                                                                                                                                                                                                              
                                                                                                                                                                                                                                                               
				},                                                                                                                                                                                                                                                         
				error: function (oError) {                                                                                                                                                                                                                                 
                                                                                                                                                                                                                                                               
				}                                                                                                                                                                                                                                                          
			});                                                                                                                                                                                                                                                         
                                                                                                                                                                                                                                                               
		},                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
		/**                                                                                                                                                                                                                                                          
		 * Similar to onAfterRendering, but this hook is invoked before the controller's View is re-rendered                                                                                                                                                         
		 * (NOT before the first rendering! onInit() is used for that one!).                                                                                                                                                                                         
		 * @memberOf com.vistex.zagriplan.WebContent.view.Detail3                                                                                                                                                                                                    
		 */                                                                                                                                                                                                                                                          
		//	onBeforeRendering: function() {                                                                                                                                                                                                                           
		//                                                                                                                                                                                                                                                           
		//	},                                                                                                                                                                                                                                                        
                                                                                                                                                                                                                                                               
		/**                                                                                                                                                                                                                                                          
		 * Called when the View has been rendered (so its HTML is part of the document). Post-rendering manipulations of the HTML could be done here.                                                                                                                
		 * This hook is the same one that SAPUI5 controls get after being rendered.                                                                                                                                                                                  
		 * @memberOf com.vistex.zagriplan.WebContent.view.Detail3                                                                                                                                                                                                    
		 */                                                                                                                                                                                                                                                          
		onAfterRendering: function () {},                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                               
		/**                                                                                                                                                                                                                                                          
		 * Called when the Controller is destroyed. Use this one to free resources and finalize activities.                                                                                                                                                          
		 * @memberOf com.vistex.zagriplan.WebContent.view.Detail3                                                                                                                                                                                                    
		 */                                                                                                                                                                                                                                                          
		onExit: function () {                                                                                                                                                                                                                                        
			base.getEventBus().unsubscribe("map", "onClick", this.onClickMap, this);                                                                                                                                                                                    
		}                                                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                               
	});                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
});                                                                                                                                                                                                                                                            